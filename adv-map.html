<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Geocomputation with R</title>
  <meta name="description" content="Forthcoming book on geographic data with R.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Geocomputation with R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://geocompr.robinlovelace.net" />
  
  <meta property="og:description" content="Forthcoming book on geographic data with R." />
  <meta name="github-repo" content="Robinlovelace/geocompr" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Geocomputation with R" />
  
  <meta name="twitter:description" content="Forthcoming book on geographic data with R." />
  

<meta name="author" content="Robin Lovelace, Jakub Nowosad, Jannes Muenchow">


<meta name="date" content="2018-04-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="location.html">
<link rel="next" href="gis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.0/leaflet-providers-plugin.js"></script>
<link href="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.css" rel="stylesheet" />
<script src="libs/leaflet-awesomemarkers-2.0.3/leaflet.awesome-markers.min.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<link href="libs/PopupTable-0.0.1/popup.css" rel="stylesheet" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99618359-1', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Geocomputation with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#development"><i class="fa fa-check"></i>Development</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-contribute"><i class="fa fa-check"></i>How to contribute?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#what-is-geocomputation"><i class="fa fa-check"></i><b>1.1</b> What is geocomputation?</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#why-geocomputation-with-r"><i class="fa fa-check"></i><b>1.2</b> Why Geocomputation with R?</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#software-for-geocomputation"><i class="fa fa-check"></i><b>1.3</b> Software for geocomputation</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#rs-spatial-ecosystem"><i class="fa fa-check"></i><b>1.4</b> R’s spatial ecosystem</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#the-history-of-r-spatial"><i class="fa fa-check"></i><b>1.5</b> The history of R-spatial</a></li>
<li class="chapter" data-level="1.6" data-path="intro.html"><a href="intro.html#exercises"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>I Basic methods</b></span></li>
<li class="chapter" data-level="2" data-path="spatial-class.html"><a href="spatial-class.html"><i class="fa fa-check"></i><b>2</b> Geographic data in R</a><ul>
<li class="chapter" data-level="" data-path="spatial-class.html"><a href="spatial-class.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="spatial-class.html"><a href="spatial-class.html#vector-data"><i class="fa fa-check"></i><b>2.1</b> Vector data</a><ul>
<li class="chapter" data-level="2.1.1" data-path="spatial-class.html"><a href="spatial-class.html#intro-sf"><i class="fa fa-check"></i><b>2.1.1</b> An introduction to simple features</a></li>
<li class="chapter" data-level="2.1.2" data-path="spatial-class.html"><a href="spatial-class.html#why-simple-features"><i class="fa fa-check"></i><b>2.1.2</b> Why simple features?</a></li>
<li class="chapter" data-level="2.1.3" data-path="spatial-class.html"><a href="spatial-class.html#basic-map"><i class="fa fa-check"></i><b>2.1.3</b> Basic map making</a></li>
<li class="chapter" data-level="2.1.4" data-path="spatial-class.html"><a href="spatial-class.html#base-args"><i class="fa fa-check"></i><b>2.1.4</b> Base plot arguments</a></li>
<li class="chapter" data-level="2.1.5" data-path="spatial-class.html"><a href="spatial-class.html#sf-classes"><i class="fa fa-check"></i><b>2.1.5</b> Simple feature classes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="spatial-class.html"><a href="spatial-class.html#raster-data"><i class="fa fa-check"></i><b>2.2</b> Raster data</a><ul>
<li class="chapter" data-level="2.2.1" data-path="spatial-class.html"><a href="spatial-class.html#an-introduction-to-raster"><i class="fa fa-check"></i><b>2.2.1</b> An introduction to raster</a></li>
<li class="chapter" data-level="2.2.2" data-path="spatial-class.html"><a href="spatial-class.html#basic-map-raster"><i class="fa fa-check"></i><b>2.2.2</b> Basic map making</a></li>
<li class="chapter" data-level="2.2.3" data-path="spatial-class.html"><a href="spatial-class.html#raster-classes"><i class="fa fa-check"></i><b>2.2.3</b> Raster classes</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="spatial-class.html"><a href="spatial-class.html#crs-intro"><i class="fa fa-check"></i><b>2.3</b> Coordinate Reference Systems</a><ul>
<li class="chapter" data-level="2.3.1" data-path="spatial-class.html"><a href="spatial-class.html#geographic-coordinate-systems"><i class="fa fa-check"></i><b>2.3.1</b> Geographic coordinate systems</a></li>
<li class="chapter" data-level="2.3.2" data-path="spatial-class.html"><a href="spatial-class.html#projected-coordinate-systems"><i class="fa fa-check"></i><b>2.3.2</b> Projected coordinate systems</a></li>
<li class="chapter" data-level="2.3.3" data-path="spatial-class.html"><a href="spatial-class.html#crs-in-r"><i class="fa fa-check"></i><b>2.3.3</b> CRSs in R</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="spatial-class.html"><a href="spatial-class.html#units"><i class="fa fa-check"></i><b>2.4</b> Units</a></li>
<li class="chapter" data-level="2.5" data-path="spatial-class.html"><a href="spatial-class.html#ex2"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="attr.html"><a href="attr.html"><i class="fa fa-check"></i><b>3</b> Attribute operations</a><ul>
<li class="chapter" data-level="" data-path="attr.html"><a href="attr.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="attr.html"><a href="attr.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="attr.html"><a href="attr.html#vector-attribute-manipulation"><i class="fa fa-check"></i><b>3.2</b> Vector attribute manipulation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="attr.html"><a href="attr.html#vector-attribute-subsetting"><i class="fa fa-check"></i><b>3.2.1</b> Vector attribute subsetting</a></li>
<li class="chapter" data-level="3.2.2" data-path="attr.html"><a href="attr.html#vector-attribute-aggregation"><i class="fa fa-check"></i><b>3.2.2</b> Vector attribute aggregation</a></li>
<li class="chapter" data-level="3.2.3" data-path="attr.html"><a href="attr.html#vector-attribute-joining"><i class="fa fa-check"></i><b>3.2.3</b> Vector attribute joining</a></li>
<li class="chapter" data-level="3.2.4" data-path="attr.html"><a href="attr.html#vec-attr-creation"><i class="fa fa-check"></i><b>3.2.4</b> Creating attributes and removing spatial information</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="attr.html"><a href="attr.html#manipulating-raster-objects"><i class="fa fa-check"></i><b>3.3</b> Manipulating raster objects</a><ul>
<li class="chapter" data-level="3.3.1" data-path="attr.html"><a href="attr.html#raster-subsetting"><i class="fa fa-check"></i><b>3.3.1</b> Raster subsetting</a></li>
<li class="chapter" data-level="3.3.2" data-path="attr.html"><a href="attr.html#summarizing-raster-objects"><i class="fa fa-check"></i><b>3.3.2</b> Summarizing raster objects</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="attr.html"><a href="attr.html#exercises-1"><i class="fa fa-check"></i><b>3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatial-operations.html"><a href="spatial-operations.html"><i class="fa fa-check"></i><b>4</b> Spatial operations</a><ul>
<li class="chapter" data-level="" data-path="spatial-operations.html"><a href="spatial-operations.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="spatial-operations.html"><a href="spatial-operations.html#introduction-1"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-vec"><i class="fa fa-check"></i><b>4.2</b> Spatial operations on vector data</a><ul>
<li class="chapter" data-level="4.2.1" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-subsetting"><i class="fa fa-check"></i><b>4.2.1</b> Spatial subsetting</a></li>
<li class="chapter" data-level="4.2.2" data-path="spatial-operations.html"><a href="spatial-operations.html#topological-relations"><i class="fa fa-check"></i><b>4.2.2</b> Topological relations</a></li>
<li class="chapter" data-level="4.2.3" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-joining"><i class="fa fa-check"></i><b>4.2.3</b> Spatial joining</a></li>
<li class="chapter" data-level="4.2.4" data-path="spatial-operations.html"><a href="spatial-operations.html#non-overlapping-joins"><i class="fa fa-check"></i><b>4.2.4</b> Non-overlapping joins</a></li>
<li class="chapter" data-level="4.2.5" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-aggr"><i class="fa fa-check"></i><b>4.2.5</b> Spatial data aggregation</a></li>
<li class="chapter" data-level="4.2.6" data-path="spatial-operations.html"><a href="spatial-operations.html#distance-relations"><i class="fa fa-check"></i><b>4.2.6</b> Distance relations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="spatial-operations.html"><a href="spatial-operations.html#spatial-ras"><i class="fa fa-check"></i><b>4.3</b> Spatial operations on raster data</a><ul>
<li class="chapter" data-level="4.3.1" data-path="attr.html"><a href="attr.html#raster-subsetting"><i class="fa fa-check"></i><b>4.3.1</b> Spatial subsetting</a></li>
<li class="chapter" data-level="4.3.2" data-path="spatial-operations.html"><a href="spatial-operations.html#map-algebra"><i class="fa fa-check"></i><b>4.3.2</b> Map algebra</a></li>
<li class="chapter" data-level="4.3.3" data-path="spatial-operations.html"><a href="spatial-operations.html#local-operations"><i class="fa fa-check"></i><b>4.3.3</b> Local operations</a></li>
<li class="chapter" data-level="4.3.4" data-path="spatial-operations.html"><a href="spatial-operations.html#focal-operations"><i class="fa fa-check"></i><b>4.3.4</b> Focal operations</a></li>
<li class="chapter" data-level="4.3.5" data-path="spatial-operations.html"><a href="spatial-operations.html#zonal-operations"><i class="fa fa-check"></i><b>4.3.5</b> Zonal operations</a></li>
<li class="chapter" data-level="4.3.6" data-path="spatial-operations.html"><a href="spatial-operations.html#global-operations-and-distances"><i class="fa fa-check"></i><b>4.3.6</b> Global operations and distances</a></li>
<li class="chapter" data-level="4.3.7" data-path="spatial-operations.html"><a href="spatial-operations.html#merging-rasters"><i class="fa fa-check"></i><b>4.3.7</b> Merging rasters</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="spatial-operations.html"><a href="spatial-operations.html#exercises-2"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transform.html"><a href="transform.html"><i class="fa fa-check"></i><b>5</b> Geometric operations</a><ul>
<li class="chapter" data-level="" data-path="transform.html"><a href="transform.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.1" data-path="transform.html"><a href="transform.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="transform.html"><a href="transform.html#reproj-geo-data"><i class="fa fa-check"></i><b>5.2</b> Reprojecting geographic data</a><ul>
<li class="chapter" data-level="5.2.1" data-path="transform.html"><a href="transform.html#which-crs-to-use"><i class="fa fa-check"></i><b>5.2.1</b> Which CRS to use?</a></li>
<li class="chapter" data-level="5.2.2" data-path="transform.html"><a href="transform.html#reproj-vec-geom"><i class="fa fa-check"></i><b>5.2.2</b> Reprojecting vector geometries</a></li>
<li class="chapter" data-level="5.2.3" data-path="transform.html"><a href="transform.html#modifying-map-projections"><i class="fa fa-check"></i><b>5.2.3</b> Modifying map projections</a></li>
<li class="chapter" data-level="5.2.4" data-path="transform.html"><a href="transform.html#reprojecting-raster-geometries"><i class="fa fa-check"></i><b>5.2.4</b> Reprojecting raster geometries</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="transform.html"><a href="transform.html#geo-vec"><i class="fa fa-check"></i><b>5.3</b> Geometric operations on vector data</a><ul>
<li class="chapter" data-level="5.3.1" data-path="transform.html"><a href="transform.html#simplification"><i class="fa fa-check"></i><b>5.3.1</b> Simplification</a></li>
<li class="chapter" data-level="5.3.2" data-path="transform.html"><a href="transform.html#centroids"><i class="fa fa-check"></i><b>5.3.2</b> Centroids</a></li>
<li class="chapter" data-level="5.3.3" data-path="transform.html"><a href="transform.html#buffers"><i class="fa fa-check"></i><b>5.3.3</b> Buffers</a></li>
<li class="chapter" data-level="5.3.4" data-path="transform.html"><a href="transform.html#affine-transformations"><i class="fa fa-check"></i><b>5.3.4</b> Affine transformations</a></li>
<li class="chapter" data-level="5.3.5" data-path="transform.html"><a href="transform.html#clipping"><i class="fa fa-check"></i><b>5.3.5</b> Clipping</a></li>
<li class="chapter" data-level="5.3.6" data-path="transform.html"><a href="transform.html#geometry-unions"><i class="fa fa-check"></i><b>5.3.6</b> Geometry unions</a></li>
<li class="chapter" data-level="5.3.7" data-path="transform.html"><a href="transform.html#type-trans"><i class="fa fa-check"></i><b>5.3.7</b> Type transformations</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="transform.html"><a href="transform.html#geo-ras"><i class="fa fa-check"></i><b>5.4</b> Geometric operations on raster data</a><ul>
<li class="chapter" data-level="5.4.1" data-path="transform.html"><a href="transform.html#extent-and-origin"><i class="fa fa-check"></i><b>5.4.1</b> Extent and origin</a></li>
<li class="chapter" data-level="5.4.2" data-path="transform.html"><a href="transform.html#aggregation-and-disaggregation"><i class="fa fa-check"></i><b>5.4.2</b> Aggregation and disaggregation</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="transform.html"><a href="transform.html#exercises-3"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="read-write.html"><a href="read-write.html"><i class="fa fa-check"></i><b>6</b> Geographic data I/O</a><ul>
<li class="chapter" data-level="" data-path="read-write.html"><a href="read-write.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="6.1" data-path="read-write.html"><a href="read-write.html#introduction-3"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="read-write.html"><a href="read-write.html#retrieving-data"><i class="fa fa-check"></i><b>6.2</b> Retrieving open data</a></li>
<li class="chapter" data-level="6.3" data-path="read-write.html"><a href="read-write.html#file-formats"><i class="fa fa-check"></i><b>6.3</b> File formats</a></li>
<li class="chapter" data-level="6.4" data-path="read-write.html"><a href="read-write.html#data-input"><i class="fa fa-check"></i><b>6.4</b> Data Input (I)</a><ul>
<li class="chapter" data-level="6.4.1" data-path="read-write.html"><a href="read-write.html#vector-data-1"><i class="fa fa-check"></i><b>6.4.1</b> Vector data</a></li>
<li class="chapter" data-level="6.4.2" data-path="read-write.html"><a href="read-write.html#raster-data-1"><i class="fa fa-check"></i><b>6.4.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="read-write.html"><a href="read-write.html#data-output"><i class="fa fa-check"></i><b>6.5</b> Data output (O)</a><ul>
<li class="chapter" data-level="6.5.1" data-path="read-write.html"><a href="read-write.html#vector-data-2"><i class="fa fa-check"></i><b>6.5.1</b> Vector data</a></li>
<li class="chapter" data-level="6.5.2" data-path="read-write.html"><a href="read-write.html#raster-data-2"><i class="fa fa-check"></i><b>6.5.2</b> Raster data</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="read-write.html"><a href="read-write.html#visual-outputs"><i class="fa fa-check"></i><b>6.6</b> Visual outputs</a></li>
<li class="chapter" data-level="6.7" data-path="read-write.html"><a href="read-write.html#exercises-4"><i class="fa fa-check"></i><b>6.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Applied geocomputation</b></span></li>
<li class="chapter" data-level="7" data-path="transport.html"><a href="transport.html"><i class="fa fa-check"></i><b>7</b> Transport applications</a><ul>
<li class="chapter" data-level="" data-path="transport.html"><a href="transport.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="7.1" data-path="transport.html"><a href="transport.html#introduction-4"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="transport.html"><a href="transport.html#bris-case"><i class="fa fa-check"></i><b>7.2</b> A case study of Bristol</a></li>
<li class="chapter" data-level="7.3" data-path="transport.html"><a href="transport.html#transport-zones"><i class="fa fa-check"></i><b>7.3</b> Transport zones</a></li>
<li class="chapter" data-level="7.4" data-path="transport.html"><a href="transport.html#desire-lines"><i class="fa fa-check"></i><b>7.4</b> Desire lines</a></li>
<li class="chapter" data-level="7.5" data-path="transport.html"><a href="transport.html#routes"><i class="fa fa-check"></i><b>7.5</b> Routes</a></li>
<li class="chapter" data-level="7.6" data-path="transport.html"><a href="transport.html#nodes"><i class="fa fa-check"></i><b>7.6</b> Nodes</a></li>
<li class="chapter" data-level="7.7" data-path="transport.html"><a href="transport.html#route-networks"><i class="fa fa-check"></i><b>7.7</b> Route networks</a></li>
<li class="chapter" data-level="7.8" data-path="transport.html"><a href="transport.html#prioritizing-new-infrastructure"><i class="fa fa-check"></i><b>7.8</b> Prioritizing new infrastructure</a></li>
<li class="chapter" data-level="7.9" data-path="transport.html"><a href="transport.html#future-directions-of-travel"><i class="fa fa-check"></i><b>7.9</b> Future directions of travel</a></li>
<li class="chapter" data-level="7.10" data-path="transport.html"><a href="transport.html#ex-transport"><i class="fa fa-check"></i><b>7.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="location.html"><a href="location.html"><i class="fa fa-check"></i><b>8</b> Location analysis</a><ul>
<li class="chapter" data-level="" data-path="location.html"><a href="location.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="8.1" data-path="location.html"><a href="location.html#introduction-5"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="location.html"><a href="location.html#case-study"><i class="fa fa-check"></i><b>8.2</b> Case study: bike shops in Germany</a></li>
<li class="chapter" data-level="8.3" data-path="location.html"><a href="location.html#tidy-the-input-data"><i class="fa fa-check"></i><b>8.3</b> Tidy the input data</a></li>
<li class="chapter" data-level="8.4" data-path="location.html"><a href="location.html#create-census-rasters"><i class="fa fa-check"></i><b>8.4</b> Create census rasters</a></li>
<li class="chapter" data-level="8.5" data-path="location.html"><a href="location.html#define-metropolitan-areas"><i class="fa fa-check"></i><b>8.5</b> Define metropolitan areas</a></li>
<li class="chapter" data-level="8.6" data-path="location.html"><a href="location.html#points-of-interest"><i class="fa fa-check"></i><b>8.6</b> Points of interest</a></li>
<li class="chapter" data-level="8.7" data-path="location.html"><a href="location.html#identifying-suitable-locations"><i class="fa fa-check"></i><b>8.7</b> Identifying suitable locations</a></li>
<li class="chapter" data-level="8.8" data-path="location.html"><a href="location.html#discussion-and-next-steps"><i class="fa fa-check"></i><b>8.8</b> Discussion and next steps</a></li>
<li class="chapter" data-level="8.9" data-path="location.html"><a href="location.html#exercises-5"><i class="fa fa-check"></i><b>8.9</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Advanced methods</b></span></li>
<li class="chapter" data-level="9" data-path="adv-map.html"><a href="adv-map.html"><i class="fa fa-check"></i><b>9</b> Making maps with R</a><ul>
<li class="chapter" data-level="" data-path="adv-map.html"><a href="adv-map.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="9.1" data-path="adv-map.html"><a href="adv-map.html#introduction-6"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="adv-map.html"><a href="adv-map.html#static-maps"><i class="fa fa-check"></i><b>9.2</b> Static maps</a><ul>
<li class="chapter" data-level="9.2.1" data-path="adv-map.html"><a href="adv-map.html#tmap-basics"><i class="fa fa-check"></i><b>9.2.1</b> tmap basics</a></li>
<li class="chapter" data-level="9.2.2" data-path="adv-map.html"><a href="adv-map.html#map-objects-shapes-and-layers"><i class="fa fa-check"></i><b>9.2.2</b> Map objects, shapes and layers</a></li>
<li class="chapter" data-level="9.2.3" data-path="adv-map.html"><a href="adv-map.html#aesthetics"><i class="fa fa-check"></i><b>9.2.3</b> Aesthetics</a></li>
<li class="chapter" data-level="9.2.4" data-path="adv-map.html"><a href="adv-map.html#color-settings"><i class="fa fa-check"></i><b>9.2.4</b> Color settings</a></li>
<li class="chapter" data-level="9.2.5" data-path="adv-map.html"><a href="adv-map.html#layouts"><i class="fa fa-check"></i><b>9.2.5</b> Layouts</a></li>
<li class="chapter" data-level="9.2.6" data-path="adv-map.html"><a href="adv-map.html#faceted-maps"><i class="fa fa-check"></i><b>9.2.6</b> Faceted maps</a></li>
<li class="chapter" data-level="9.2.7" data-path="adv-map.html"><a href="adv-map.html#inset-maps"><i class="fa fa-check"></i><b>9.2.7</b> Inset maps</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="adv-map.html"><a href="adv-map.html#animated-maps"><i class="fa fa-check"></i><b>9.3</b> Animated maps</a></li>
<li class="chapter" data-level="9.4" data-path="adv-map.html"><a href="adv-map.html#interactive-maps"><i class="fa fa-check"></i><b>9.4</b> Interactive maps</a></li>
<li class="chapter" data-level="9.5" data-path="adv-map.html"><a href="adv-map.html#web-mapping-applications-with-shiny"><i class="fa fa-check"></i><b>9.5</b> Web mapping applications with shiny</a></li>
<li class="chapter" data-level="9.6" data-path="adv-map.html"><a href="adv-map.html#other-mapping-packages"><i class="fa fa-check"></i><b>9.6</b> Other mapping packages</a></li>
<li class="chapter" data-level="9.7" data-path="adv-map.html"><a href="adv-map.html#exercises-6"><i class="fa fa-check"></i><b>9.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="gis.html"><a href="gis.html"><i class="fa fa-check"></i><b>10</b> Bridges to GIS software</a><ul>
<li class="chapter" data-level="10.1" data-path="gis.html"><a href="gis.html#rqgis"><i class="fa fa-check"></i><b>10.1</b> (R)QGIS</a></li>
<li class="chapter" data-level="10.2" data-path="gis.html"><a href="gis.html#rsaga"><i class="fa fa-check"></i><b>10.2</b> (R)SAGA</a></li>
<li class="chapter" data-level="10.3" data-path="gis.html"><a href="gis.html#grass-through-rgrass7"><i class="fa fa-check"></i><b>10.3</b> GRASS through <strong>rgrass7</strong></a></li>
<li class="chapter" data-level="10.4" data-path="gis.html"><a href="gis.html#when-to-use-what"><i class="fa fa-check"></i><b>10.4</b> When to use what?</a></li>
<li class="chapter" data-level="10.5" data-path="gis.html"><a href="gis.html#exercises-7"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="raster-vector.html"><a href="raster-vector.html"><i class="fa fa-check"></i><b>11</b> Raster-vector interactions</a><ul>
<li class="chapter" data-level="" data-path="raster-vector.html"><a href="raster-vector.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="11.1" data-path="raster-vector.html"><a href="raster-vector.html#introduction-7"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="raster-vector.html"><a href="raster-vector.html#raster-cropping"><i class="fa fa-check"></i><b>11.2</b> Raster cropping</a></li>
<li class="chapter" data-level="11.3" data-path="raster-vector.html"><a href="raster-vector.html#raster-extraction"><i class="fa fa-check"></i><b>11.3</b> Raster extraction</a></li>
<li class="chapter" data-level="11.4" data-path="raster-vector.html"><a href="raster-vector.html#rasterization"><i class="fa fa-check"></i><b>11.4</b> Rasterization</a></li>
<li class="chapter" data-level="11.5" data-path="raster-vector.html"><a href="raster-vector.html#spatial-vectorization"><i class="fa fa-check"></i><b>11.5</b> Spatial vectorization</a></li>
<li class="chapter" data-level="11.6" data-path="raster-vector.html"><a href="raster-vector.html#exercises-8"><i class="fa fa-check"></i><b>11.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="algorithms-and-functions-for-geocomputation.html"><a href="algorithms-and-functions-for-geocomputation.html"><i class="fa fa-check"></i><b>12</b> Algorithms and functions for geocomputation</a><ul>
<li class="chapter" data-level="" data-path="algorithms-and-functions-for-geocomputation.html"><a href="algorithms-and-functions-for-geocomputation.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="12.1" data-path="algorithms-and-functions-for-geocomputation.html"><a href="algorithms-and-functions-for-geocomputation.html#geographic-algorithms"><i class="fa fa-check"></i><b>12.1</b> Geographic algorithms</a></li>
<li class="chapter" data-level="12.2" data-path="algorithms-and-functions-for-geocomputation.html"><a href="algorithms-and-functions-for-geocomputation.html#functions"><i class="fa fa-check"></i><b>12.2</b> Functions</a></li>
<li class="chapter" data-level="12.3" data-path="algorithms-and-functions-for-geocomputation.html"><a href="algorithms-and-functions-for-geocomputation.html#implementation"><i class="fa fa-check"></i><b>12.3</b> Implementation</a></li>
<li class="chapter" data-level="12.4" data-path="location.html"><a href="location.html#case-study"><i class="fa fa-check"></i><b>12.4</b> Case study</a></li>
<li class="chapter" data-level="12.5" data-path="algorithms-and-functions-for-geocomputation.html"><a href="algorithms-and-functions-for-geocomputation.html#exercises-9"><i class="fa fa-check"></i><b>12.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="spatial-cv.html"><a href="spatial-cv.html"><i class="fa fa-check"></i><b>13</b> Statistical learning for geographic data</a><ul>
<li class="chapter" data-level="" data-path="spatial-cv.html"><a href="spatial-cv.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="13.1" data-path="spatial-cv.html"><a href="spatial-cv.html#intro-cv"><i class="fa fa-check"></i><b>13.1</b> Introduction</a></li>
<li class="chapter" data-level="13.2" data-path="spatial-cv.html"><a href="spatial-cv.html#case-landslide"><i class="fa fa-check"></i><b>13.2</b> Case study: Landslide susceptibility</a></li>
<li class="chapter" data-level="13.3" data-path="spatial-cv.html"><a href="spatial-cv.html#conventional-model"><i class="fa fa-check"></i><b>13.3</b> Conventional modeling approach in R</a></li>
<li class="chapter" data-level="13.4" data-path="spatial-cv.html"><a href="spatial-cv.html#intro-cv"><i class="fa fa-check"></i><b>13.4</b> Introduction to (spatial) cross-validation</a></li>
<li class="chapter" data-level="13.5" data-path="spatial-cv.html"><a href="spatial-cv.html#spatial-cv-with-mlr"><i class="fa fa-check"></i><b>13.5</b> Spatial CV with <strong>mlr</strong></a><ul>
<li class="chapter" data-level="13.5.1" data-path="spatial-cv.html"><a href="spatial-cv.html#glm"><i class="fa fa-check"></i><b>13.5.1</b> Generalized linear model</a></li>
<li class="chapter" data-level="13.5.2" data-path="spatial-cv.html"><a href="spatial-cv.html#svm"><i class="fa fa-check"></i><b>13.5.2</b> Spatial tuning of machine-learning hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="spatial-cv.html"><a href="spatial-cv.html#conclusions"><i class="fa fa-check"></i><b>13.6</b> Conclusions</a></li>
<li class="chapter" data-level="13.7" data-path="spatial-cv.html"><a href="spatial-cv.html#exercises-10"><i class="fa fa-check"></i><b>13.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://robinlovelace.net/">Robin Lovelace</a></li>
<li><a href="https://nowosad.github.io/">Jakub Nowosad</a></li>
<li><a href="http://www.geographie.uni-jena.de/en/Muenchow.html">Jannes Muenchow</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Geocomputation with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="adv-map" class="section level1">
<h1><span class="header-section-number">9</span> Making maps with R</h1>
<div id="prerequisites-7" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<ul>
<li>This chapter requires the following packages that we have already been using:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">library</span>(spData)
<span class="kw">library</span>(spDataLarge)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<ul>
<li>In addition it uses the following visualization packages:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(leaflet) <span class="co"># for interactive maps</span>
<span class="kw">library</span>(mapview) <span class="co"># for interactive maps</span>
<span class="kw">library</span>(shiny)   <span class="co"># for web applications</span>
<span class="kw">library</span>(tmap)    <span class="co"># for static and interactive maps</span></code></pre></div>
</div>
<div id="introduction-6" class="section level2">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p>A satisfying and important aspect of geographic research is producing and communicating the results in the form of maps. Map making — the art of Cartography — is an ancient skill that involves precision, consideration of the map-reader and often an element of creativity. Basic plotting of geographic data is straightforward in R with <code>plot()</code> (see section <a href="spatial-class.html#basic-map">2.1.3</a>), and it is possible to create advanced maps using base R methods <span class="citation">(Murrell <a href="#ref-murrell_r_2016">2016</a>)</span>.</p>
<p>This chapter focuses on dedicated map-making packages, especially <strong>tmap</strong>, for reasons that are explained in section <a href="adv-map.html#static-maps">9.2</a>. There are a multitude of options but when learning a new skill (in this case map making), it makes sense to gain depth-of-knowledge in one package before branching out, a concept that also applies to the choice of programming language as we saw in Chapter <a href="intro.html#intro">1</a>. It is worth developing advanced map making skills not only because it is a fun activity that can produce beautiful results. Map making also has important practical applications. A carefully crafted map can help ensure that time spent in the analysis phases of geocomputational projects — for example using methods covered in chapters <a href="spatial-class.html#spatial-class">2</a> to <a href="transform.html#transform">5</a> — are communicated effectively <span class="citation">(<span class="citeproc-not-found" data-reference-id="brewer_designing_2015"><strong>???</strong></span>)</span>:</p>
<blockquote>
<p>Amateur-looking maps can undermine your audience’s ability to understand important information and weaken the presentation of a professional data investigation.</p>
</blockquote>
<!-- Todo: consider adding footnote saying it's good to focus on visualization early as in R4DS but that we cover it later because there's a risk of getting distracted by pretty pictures to the detriment of good analysis. -->
<p>Maps have been used for several thousand years for a wide variety of purposes. Historic examples include maps of buildings and land ownership in the Old Babylonian dynasty more than 3000 years ago and Ptolemy’s world map in his masterpiece <em>Geography</em> nearly 2000 years ago <span class="citation">(Talbert <a href="#ref-talbert_ancient_2014">2014</a>)</span>. However, maps have historically been out of reach for everyday people.</p>
<p>Modern computing has the potential to change this. Map making skills can also help meet research and public engagement objectives. From a research perspective clear maps are often be the best way to present the results of geocomputational research. From policy and ‘citizen science’ perspectives, attractive and engaging maps can help change peoples’ minds, based on the evidence. Map making is therefore a critical part of geocomputation and its emphasis not only on describing, but also <em>changing</em> the world (see Chapter <a href="intro.html#intro">1</a>).</p>
<!-- info about relation between efficiency and editability -->
<!-- intro to the chapter structure -->
</div>
<div id="static-maps" class="section level2">
<h2><span class="header-section-number">9.2</span> Static maps</h2>
<p>Static maps are the most common type of visual output from geocomputation. They are fixed images that can be included in printed outputs or published online. The majority of maps contained in this book, for example, are static maps saved as <code>.png</code> files (interactive maps are covered in section <a href="adv-map.html#interactive-maps">9.4</a>).</p>
<p>The generic <code>plot()</code> function is often the fastest way to create static maps from vector and raster spatial objects, as demonstrated in sections <a href="spatial-class.html#basic-map">2.1.3</a> and <a href="spatial-class.html#basic-map-raster">2.2.2</a>. Sometimes the simplicity and speed of this approach is sufficient, especially during the development phase of a project: when using R interactively to understand a geographic dataset, you will likely be the only person who sees them. The base R approach is also extensible, with <code>plot()</code> offering dozens of arguments and the <strong>grid</strong> providing functions for low-level control of graphical outputs, — see <em>R Graphics</em> <span class="citation">(Murrell <a href="#ref-murrell_r_2016">2016</a>)</span>, especially Chapter <a href="https://www.stat.auckland.ac.nz/~paul/RG2e/chapter14.html">14</a>. The focus of this section, however, is making static with <strong>tmap</strong>.</p>
<p>Why <strong>tmap</strong>? It is a powerful and flexible map-making package with sensible defaults. It has a concise syntax that allows for the creation of attractive maps with minimal code, that will be familiar to <strong>ggplot2</strong> users. Furthermore, <strong>tmap</strong> has a unique capability to generate static and interactive maps using the same code via <code>tmap_mode()</code>. It accepts a wider range of spatial classes (including <code>raster</code> objects) than alternatives such as <strong>ggplot2</strong>, as documented in vignettes <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-nutshell.html"><code>tmap-nutshell</code></a> and <a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-modes.html"><code>tmap-modes</code></a> and an excellent academic paper on the subject <span class="citation">(Tennekes <a href="#ref-tennekes_tmap_2018">2018</a><a href="#ref-tennekes_tmap_2018">b</a>)</span>. This section teaches how to make static maps with <strong>tmap</strong>, emphasizing the important aesthetic and layout options.</p>
<div id="tmap-basics" class="section level3">
<h3><span class="header-section-number">9.2.1</span> tmap basics</h3>
<p><strong>tmap</strong> generates maps with sensible defaults for a wide range of spatial objects with <code>tm_shape()</code> (which accepts raster and vector objects), followed by one or more layer elements such as <code>tm_fill()</code> and <code>tm_dots()</code>. These functions are used singularly and in combination in the code chunk below, which generates the maps presented in Figure <a href="adv-map.html#fig:tmshape">9.1</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add fill layer to nz shape</span>
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>() 
<span class="co"># Add border layer to nz shape</span>
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_borders</span>() 
<span class="co"># Add fill and border layers to nz shape</span>
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>() +<span class="st"> </span><span class="kw">tm_borders</span>() </code></pre></div>
<!--

```r
plot(st_union(st_geometry(nz)), col = "lightgray")
box()
plot(st_geometry(nz), col = "white")
box()
plot(st_geometry(nz), col = "lightgray")
box()
```
-->
<div class="figure" style="text-align: center"><span id="fig:tmshape"></span>
<img src="figures/tmshape-1.png" alt="New Zealand's shape plotted with fill (left), border (middle) and fill *and* border (right) layers added using **tmap** functions." width="576" />
<p class="caption">
Figure 9.1: New Zealand’s shape plotted with fill (left), border (middle) and fill <em>and</em> border (right) layers added using <strong>tmap</strong> functions.
</p>
</div>
<p>The object passed to <code>tm_shape()</code> in this case is <code>nz</code>, which represents the regions of New Zealand. Layers are added to represent <code>nz</code> visually, with <code>tm_fill()</code> and <code>tm_borders()</code> creating shaded areas (right panel) and border outlines (middle panel) in Figure <a href="adv-map.html#fig:tmshape">9.1</a>, respectively.</p>
<p>This is an intuitive approach to map making: the common task of <em>adding</em> new layers is undertaken by the addition operator <code>+</code>, followed by <code>tm_*()</code>. The asterisk (*) refers to a wide range of layer types which have self-explanatory names including <code>fill</code>, <code>borders</code> (demonstrated above), <code>bubbles</code>, <code>text</code> and <code>raster</code> (see `<code>?</code>tmap-element``` for a list of available elements). This ‘layering’ is illustrated in the right panel of Figure <a href="adv-map.html#fig:tmshape">9.1</a>, which shows the result of adding a border <em>on top of</em> the fill layer. The order in which layers are added is the order in which they are rendered.</p>

<div class="rmdnote">
<code>qtm()</code> is a handy function for <strong>q</strong>uickly creating <strong>t</strong>map <strong>m</strong>aps (hence the snappy name). It is concise and provides a good default visualization in many cases: <code>qtm(nz)</code>, for example, is equivalent to <code>tm_shape(nz) + tm_fill() + tm_borders()</code>. Further, layers can be added concisely using multiple <code>qtm()</code> calls, such as <code>qtm(nz) + qtm(nz_height)</code>. The disadvantage is that it makes aesthetics of individual layers harder to control, explaining why we avoid teaching it in this chapter.
</div>
<p></p>
</div>
<div id="map-objects-shapes-and-layers" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Map objects, shapes and layers</h3>
<p>A useful feature of <strong>tmap</strong> is its ability to store <em>objects</em> representing maps. The code chunk below demonstrates this by saving the last plot in Figure <a href="adv-map.html#fig:tmshape">9.1</a> as an object of class <code>tmap</code> (note the use of <code>tm_polygons()</code> which condenses <code>tm_fill()  + tm_borders()</code> into a single function):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_nz =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_polygons</span>()
<span class="kw">class</span>(map_nz)
<span class="co">#&gt; [1] &quot;tmap&quot;</span></code></pre></div>
<p><code>map_nz</code> can be plotted later, for example by adding additional layers (as shown below) or simply running <code>map_nz</code> in the console, which is equivalent to <code>print(map_nz)</code>.</p>
<p>New <em>shapes</em> can be added with <code>+ tm_shape(new_obj)</code>. In this case <code>new_obj</code> represents a new spatial object to be plotted on top of preceding layers. When a new new shape is added in this way all subsequent aesthetic functions refer to it, until another new shape is added. This syntax allows the creation of maps with multiple shapes and layers, as illustrated in the next code chunk which uses the function <code>tm_raster()</code> to plot a raster layer (with <code>alpha</code> set to make the layer semi-transparent):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_nz1 =<span class="st"> </span>map_nz +
<span class="st">  </span><span class="kw">tm_shape</span>(nz_elev) +<span class="st"> </span><span class="kw">tm_raster</span>(<span class="dt">alpha =</span> <span class="fl">0.7</span>)</code></pre></div>
<p>Building on the previously created <code>map_nz</code> object the preceding code creates a new map object <code>map_nz1</code> which contains another shape (<code>nz_eleve</code>), representing average elevation across New Zealand (see Figure <a href="adv-map.html#fig:tmlayers">9.2</a>, left). More shapes and layers can be added, as illustrated in the code chunk below which creates <code>nz_water</code>, representing New Zealand’s <a href="https://en.wikipedia.org/wiki/Territorial_waters">territorial waters</a>, and adds the resulting lines to an existing map object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_water =<span class="st"> </span><span class="kw">st_union</span>(nz) %&gt;%<span class="st"> </span><span class="kw">st_buffer</span>(<span class="dv">22200</span>) %&gt;%
<span class="st">  </span><span class="kw">st_cast</span>(<span class="dt">to =</span> <span class="st">&quot;LINESTRING&quot;</span>)
map_nz2 =<span class="st"> </span>map_nz1 +
<span class="st">  </span><span class="kw">tm_shape</span>(nz_water) +<span class="st"> </span><span class="kw">tm_lines</span>()</code></pre></div>
<p>There is no limit to the number of layers or shapes that can be added to <code>tmap</code> objects. The same shape can even be used multiple times. The final map illustrated in Figure <a href="adv-map.html#fig:tmlayers">9.2</a> is created by adding a layer representing high points (stored in the object <code>nz_height</code>) onto the previously created <code>map_nz2</code> object with <code>tm_dots()</code> (see <code>?tm_dots</code> and <code>?tm_bubbles</code> for details on <strong>tmap</strong>’s point plotting functions). The resulting map, which has 5 layers, is illustrated in the right-hand panel of:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_nz3 =<span class="st"> </span>map_nz2 +
<span class="st">  </span><span class="kw">tm_shape</span>(nz_height) +<span class="st"> </span><span class="kw">tm_dots</span>()</code></pre></div>
<p>A useful and little known feature of <strong>tmap</strong> is that multiple map objects can be arranged in a single ‘metaplot’ with <code>tmap_arrange()</code>. This is demonstrated in the code chunk below which plots <code>map_nz1</code> to <code>map_nz3</code>, resulting in Figure <a href="adv-map.html#fig:tmlayers">9.2</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tmap_arrange</span>(map_nz1, map_nz2, map_nz3)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tmlayers"></span>
<img src="figures/tmlayers-1.png" alt="Maps with additional layers added to the final map of Figure 9.1." width="576" />
<p class="caption">
Figure 9.2: Maps with additional layers added to the final map of Figure 9.1.
</p>
</div>
<p>Additional elements such as north arrows (<code>tm_compass()</code>), scale bars (<code>tm_scale_bar()</code>) and layout options (<code>tm_layout()</code>) can also be added with the <code>+</code> operator. Aesthetic settings, however, are controlled by arguments to layer functions.</p>
</div>
<div id="aesthetics" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Aesthetics</h3>
<p>The plots in the previous section demonstrate <strong>tmap</strong>’s default aesthetic settings. Grey shades are used for <code>tm_fill()</code> and <code>tm_bubbles()</code> layers and a continuous red line is used to represent lines created with <code>tm_lines()</code>. Of course, these default values and other aesthetics can be overridden. The purpose this section is to show how.</p>
<p>There are two main types of map aesthetics: those that change with the data and those that are constant. Unlike <strong>ggplot2</strong> which uses the helper function <code>aes()</code> to represent the former, <strong>tmap</strong> layer functions accept aesthetic arguments that are either constant values <em>or</em> variable fields. The most commonly used aesthetics for fill and border layers include color, transparency, line width and line type, (set with <code>col</code>, <code>alpha</code>, <code>lwd</code>, and <code>lty</code> arguments respectively). The impact of setting these with fixed values is illustrated in Figure <a href="adv-map.html#fig:tmstatic">9.3</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ma1 =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)
ma2 =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>)
ma3 =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_borders</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
ma4 =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">3</span>)
ma5 =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_borders</span>(<span class="dt">lty =</span> <span class="dv">2</span>)
ma6 =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.3</span>) +
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">tmap_arrange</span>(ma1, ma2, ma3, ma4, ma5, ma6)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tmstatic"></span>
<img src="figures/tmstatic-1.png" alt="The impact of changing commonly used fill and border aesthetics to fixed values." width="576" />
<p class="caption">
Figure 9.3: The impact of changing commonly used fill and border aesthetics to fixed values.
</p>
</div>
<p>Like base R plots, arguments defining aesthetics can also receive values that vary. Unlike the base R code below (which generates the left panel in Figure <a href="adv-map.html#fig:tmcol">9.4</a>), <strong>tmap</strong> aesthetic arguments will not accept a numeric vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(nz), <span class="dt">col =</span> <span class="dv">1</span>:<span class="kw">nrow</span>(nz))      <span class="co"># works</span>
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="dv">1</span>:<span class="kw">nrow</span>(nz)) <span class="co"># fails:</span>
<span class="co">#&gt; Error: Fill argument neither colors nor valid variable name(s)</span></code></pre></div>
<p>Instead <code>col</code> (and other aesthetics that can vary such as <code>lwd</code> for line layers and <code>size</code> for point layers) requires a character string naming an attribute associated with the geometry to be plotted. Thus, one would achieve the desired (plotted in the right-hand panel of Figure <a href="adv-map.html#fig:tmcol">9.4</a>) result as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz$col =<span class="st"> </span><span class="dv">1</span>:<span class="kw">nrow</span>(nz)
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;col&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tmcol"></span>
<img src="figures/tmcol-1.png" alt="Comparison of base (left) and tmap (right) handling of a numeric color field." width="50%" /><img src="figures/tmcol-2.png" alt="Comparison of base (left) and tmap (right) handling of a numeric color field." width="50%" />
<p class="caption">
Figure 9.4: Comparison of base (left) and tmap (right) handling of a numeric color field.
</p>
</div>
<p>An important argument in functions defining aesthetic layers such as <code>tm_fill()</code> is <code>title</code>, which sets the title of the associated legend. The following code chunk demonstrates this functionality by providing a more attractive name than the variable name <code>Land_area</code> (note the use of <code>expression()</code> for to create superscript text):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">legend_title =<span class="st"> </span><span class="kw">expression</span>(<span class="st">&quot;Area (km&quot;</span>^<span class="dv">2</span>*<span class="st">&quot;)&quot;</span>)
map_nza =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +
<span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;Land_area&quot;</span>, <span class="dt">title =</span> legend_title) +<span class="st"> </span><span class="kw">tm_borders</span>()</code></pre></div>
<p>The resulting <code>tmap</code> object <code>map_nza</code> will be used, alongside <code>map_nz</code>, to illustrate different layout settings in the next section.</p>
</div>
<div id="color-settings" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Color settings</h3>
<p>Color settings are an important part of map design. They can have a major impact on how spatial variability is portrayed as illustrated in Figure <a href="adv-map.html#fig:tmpal">9.5</a>. This shows four ways of coloring regions in New Zealand depending on median income, from right to left (and demonstrated in the code chunk below):</p>
<ul>
<li>The default setting uses ‘pretty’ breaks, described in the next paragraph</li>
<li><code>breaks</code> which allows you to manually set the breaks</li>
<li><code>n</code> which sets the number of bins into which numeric variables are categorized and</li>
<li><code>palette</code> which defines the color scheme, for example <code>Reds</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">breaks =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) *<span class="st"> </span><span class="dv">10000</span>
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;Median_income&quot;</span>)
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;Median_income&quot;</span>, <span class="dt">breaks =</span> breaks)
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;Median_income&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>)
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;Median_income&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;RdBu&quot;</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:tmpal"></span>
<img src="figures/tmpal-1.png" alt="Illustration of settings that affect color settings. The results show (from left to right): default settings, manual breaks, n breaks, and the impact of changing the palette." width="576" />
<p class="caption">
Figure 9.5: Illustration of settings that affect color settings. The results show (from left to right): default settings, manual breaks, n breaks, and the impact of changing the palette.
</p>
</div>
<p>Another way to change color settings is by altering color break (or bin) settings. In addition to manually setting <code>breaks</code> <strong>tmap</strong> allows users to specify algorithms to automatically create breaks with the <code>style</code> argument. Six of the most useful break styles are illustrated in Figure <a href="adv-map.html#fig:break-styles">9.6</a> and described in the bullet points below:</p>
<ul>
<li><code>style = pretty</code>, the default setting, rounds breaks into whole numbers where possible and spaces them evenly</li>
<li><code>style = equal</code> divides input values into bins of equal range, and is appropriate for variables with a uniform distribution (not recommended for variables with a skewed distribution as the resulting map may end-up having little color diversity)</li>
<li><code>style = quantile</code> ensures the same number of observations fall into each category (with the potential down side that bin ranges can vary widely)</li>
<li><code>style = jenks</code> identifies groups of similar values in the data and maximizes the differences between categories</li>
<li><code>style = cont</code> (and <code>order</code>) present a large number of colors over continuous color field, and are particularly suited for continuous rasters (<code>order</code> can help visualize skewed distributions)</li>
<li><code>style = cat</code> was designed to represent categorical values and assures that each category receives a unique color. <!-- references for more info --></li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:break-styles"></span>
<img src="figures/break-styles-1.png" alt="Illustration of different binning methods set using the style argument in tmap." width="576" />
<p class="caption">
Figure 9.6: Illustration of different binning methods set using the style argument in tmap.
</p>
</div>

<div class="rmdnote">
Although <code>style</code> is an argument of <strong>tmap</strong> functions it in facts originates as an argument in <code>classInt::classIntervals()</code> — see the help page of this function for details.
</div>
<p></p>
<p>Palettes define the color ranges associated the bins determined by the <code>breaks</code>, <code>n</code>, and <code>style</code> arguments described above. The default color palette is specified in <code>tm_layout()</code> (see section <a href="adv-map.html#layouts">9.2.5</a> to learn more), however, it could be quickly changed using the <code>palette</code> argument. It expects a vector of colors or a new color palette name, which can be selected interactively with <code>tmaptools::palette_explorer()</code>. You can add a <code>-</code> as prefix to reverse the palette order.</p>
<p>There are three main groups of color palettes - categorical, sequential and diverging (Figure <a href="adv-map.html#fig:colpal">9.7</a>), and each of them serves a different purpose. Categorical palettes consist of easily distinguishable colors and are most appropriate for categorical data without any particular order such as state names or land cover classes. Colors should be intuitive: rivers should be blue, for example, and pastures green. Avoid too many categories: maps with large legends and many colors can be uninterpretable.<a href="#fn55" class="footnoteRef" id="fnref55"><sup>55</sup></a></p>
<p>The second group is sequential palettes. These follow a gradient, for example from light to dark colors (light colors tend to represent lower values), and appropriate for continuous (numeric) variables. Sequential palettes can be single (<code>Blues</code> go from light to dark blue for example) or multi-color/hue (<code>YlOrBr</code> is gradient from light yellow to brown via orange, for example), as demonstrated in the code chunk below — output not shown, run the code yourself to see the results!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;Population&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Blues&quot;</span>)
<span class="kw">tm_shape</span>(nz) +<span class="st"> </span><span class="kw">tm_fill</span>(<span class="st">&quot;Population&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;YlOrBr&quot;</span>)</code></pre></div>
<p>The last group, diverging palettes, typically range between three distinct colors (purple-white-green in Figure <a href="adv-map.html#fig:colpal">9.7</a>) and are usually created by joining two single color sequential palettes with the darker colors at each end. Their main purpose is too visualize the difference from an important reference point, e.g. a certain temperature, the median household income or the mean probability for a drought event.</p>
<div class="figure" style="text-align: center"><span id="fig:colpal"></span>
<img src="figures/colpal-1.png" alt="Examples of categorical, sequential and diverging palettes." width="576" />
<p class="caption">
Figure 9.7: Examples of categorical, sequential and diverging palettes.
</p>
</div>
<p>There are two important principles for consideration when working with colors - perceptibility and accessibility. Firstly, colors on maps should match our perception. This means that certain colors are viewed through our experience and also cultural lenses. For example, green color usually represent vegetation or lowlands and blue is connected with water or cool. Color palettes also should be easy to understand by effectively conveying information. It should be clear which values are lower and which are higher, and colors should change gradually. This property is not preserved in the rainbow color palette, therefore we suggest avoiding it in spatial data visualization <span class="citation">(Borland and Ii <a href="#ref-borland_rainbow_2007">2007</a>)</span>. Secondly, changes in colors should be accessible to the largest number of people. Therefore, it is important to use colorblind friendly palettes as often as possible.<a href="#fn56" class="footnoteRef" id="fnref56"><sup>56</sup></a></p>
</div>
<div id="layouts" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Layouts</h3>
<p>The map layout refers to the combination of all map elements into a cohesive map. Map elements include among others the objects to be mapped, the title, the scale bar, margins and aspect ratios, while the color settings covered in the previous section relate to the palette and break-points used affect how the map looks. Both may result in subtle changes that can have an equally large impact on the impression left by your maps.</p>
<p><strong>tmap</strong> allows a wide variety of layout settings to be changed, some of which are illustrated in Figure <a href="adv-map.html#fig:layout1">9.8</a>, produced using the following code (see <code>args(tm_layout)</code> or <code>?tm_layout</code> for a full list):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_nz +<span class="st"> </span><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&quot;New Zealand&quot;</span>)
map_nz +<span class="st"> </span><span class="kw">tm_layout</span>(<span class="dt">scale =</span> <span class="dv">5</span>)
map_nz +<span class="st"> </span><span class="kw">tm_layout</span>(<span class="dt">bg.color =</span> <span class="st">&quot;lightblue&quot;</span>)
map_nz +<span class="st"> </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:layout1"></span>
<img src="figures/layout1-1.png" alt="Layout options specified by (from left to right) title, scale, bg.color and frame arguments." width="576" />
<p class="caption">
Figure 9.8: Layout options specified by (from left to right) title, scale, bg.color and frame arguments.
</p>
</div>
<p>The other arguments in <code>tm_layout()</code> provide control over many more aspects of the map in relation to the canvas on which it is placed. Some useful layout settings are listed below (see Figure <a href="adv-map.html#fig:layout2">9.9</a> for illustrations of a selection of these):</p>
<ul>
<li>Frame width (<code>frame.lwd</code>) and an option to allow double lines (<code>frame.double.line</code>).</li>
<li>Margin settings including <code>outer.margin</code> and <code>inner.margin</code>.</li>
<li>Font settings, controlled by <code>fontface</code> and <code>fontfamily</code>.</li>
<li>Legend settings including binary options such as <code>legend.show</code> (whether or not to show the legend) <code>legend.only</code> (omit the map) and <code>legend.outside</code> (should the legend go outside the map?), as well as multiple choice settings such as <code>legend.position</code>.</li>
<li>Default colors of aesthetic layers (<code>aes.color</code>), map attributes such as the frame (<code>attr.color</code>).</li>
<li>Color settings controlling <code>sepia.intensity</code> (how yellowy the map looks) and <code>saturation</code> (a color-greyscale).</li>
</ul>
<div class="figure" style="text-align: center"><span id="fig:layout2"></span>
<img src="figures/layout2-1.png" alt="Illustration of selected layout options." width="576" />
<p class="caption">
Figure 9.9: Illustration of selected layout options.
</p>
</div>
<p>The impact of changing the color settings listed above is illustrated in Figure <a href="adv-map.html#fig:layout3">9.10</a> (see <code>?tm_layout</code> for a full list).</p>
<div class="figure" style="text-align: center"><span id="fig:layout3"></span>
<img src="figures/layout3-1.png" alt="Illustration of selected color-related layout options." width="576" />
<p class="caption">
Figure 9.10: Illustration of selected color-related layout options.
</p>
</div>
<!-- Maybe reverse order and progress from the high- to the low-level control. Overall, this section reads a bit like a vignette. Is this the intention. -->
<p>Beyond the low-level control over layouts and colors, <strong>tmap</strong> also offers high-level styles, using <code>tm_style_</code> functions (representing the second meaning of ‘style’ in the package). Some styles such as <code>tm_style_cobalt()</code> result in stylized maps while others such as <code>tm_style_grey()</code> make more subtle changes, as illustrated in Figure <a href="adv-map.html#fig:tmstyles">9.11</a>, created using code below (see <code>09-tmstyles.R</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_nza +<span class="st"> </span><span class="kw">tm_style_bw</span>()
map_nza +<span class="st"> </span><span class="kw">tm_style_classic</span>()
map_nza +<span class="st"> </span><span class="kw">tm_style_cobalt</span>()
map_nza +<span class="st"> </span><span class="kw">tm_style_col_blind</span>()</code></pre></div>
<pre><code>#&gt; Warning in tm_style_bw(): tm_style_bw is deprecated as of tmap version 2.0.
#&gt; Please use tm_style(&quot;bw&quot;, ...) instead
#&gt; Warning in tm_style_classic(): tm_style_classic is deprecated as of tmap
#&gt; version 2.0. Please use tm_style(&quot;classic&quot;, ...) instead
#&gt; Warning in tm_style_cobalt(): tm_style_white is deprecated as of tmap
#&gt; version 2.0. Please use tm_style(&quot;cobalt&quot;, ...) instead
#&gt; Warning in tm_style_col_blind(): tm_style_col_blind is deprecated as of
#&gt; tmap version 2.0. Please use tm_style(&quot;col_blind&quot;, ...) instead</code></pre>
<div class="figure" style="text-align: center"><span id="fig:tmstyles"></span>
<img src="figures/tmstyles-1.png" alt="Selected tmap styles: bw, classic, cobalt and color blind (from left to right)." width="576" />
<p class="caption">
Figure 9.11: Selected tmap styles: bw, classic, cobalt and color blind (from left to right).
</p>
</div>

<div class="rmdnote">
A preview of predefined styles can be generated by executing <code>tmap_style_catalogue()</code>. This creates a folder called <code>tmap_style_previews</code> containing (in <strong>tmap</strong> 2.0) 10 images. Each image, from <code>tm_style_albatross.png</code> to <code>tm_style_white.png</code> shows a faceted map of Europe in the corresponding style. Note: <code>tmap_style_catalogue()</code> takes some time to run.
</div>
<p></p>
<!-- - north arrow -->
<!-- - scale bar -->
</div>
<div id="faceted-maps" class="section level3">
<h3><span class="header-section-number">9.2.6</span> Faceted maps</h3>
<p>Faceted maps, also referred to as ‘small multiples’, are composed of many maps arranged side-by-side, and sometimes stacked vertically. Facets enable the visualization of how spatial relationships change with respect to another variable, such as time. The changing populations of settlements, for example, can be represented in a faceted map with each panel representing the population at a particular moment in time. The time dimension could be represented via another <em>aesthetic</em> such as color. However, this risks cluttering the map because it will involve multiple overlapping points (cities do not tend to move over time!).</p>
<p>Typically all individual facets in a faceted map contain the same geometry data repeated multiple times, once for each column in the attribute data (this is the default plotting method for <code>sf</code> objects, see <a href="spatial-class.html#spatial-class">2</a>). However, facets can also represent shifting geometries such as as the evolution of a point pattern over time. This use case of faceted plot is illustrated in Figure <a href="adv-map.html#fig:urban-facet">9.12</a>.</p>
<!-- todo: describe data type (long) and nrow vs ncol -->
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">urb_1970_2030 =<span class="st"> </span>urban_agglomerations %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year %in%<span class="st"> </span><span class="kw">c</span>(<span class="dv">1970</span>, <span class="dv">1990</span>, <span class="dv">2010</span>, <span class="dv">2030</span>))
<span class="kw">tm_shape</span>(world) +<span class="st"> </span><span class="kw">tm_polygons</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_shape</span>(urb_1970_2030) +
<span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="st">&quot;population_millions&quot;</span>) +
<span class="st">  </span><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">free.coords =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:urban-facet"></span>
<img src="figures/urban-facet-1.png" alt="Faceted map showing the top 30 largest 'urban agglomerations' from 1970 to 2030 based on population projects by the United Nations." width="576" />
<p class="caption">
Figure 9.12: Faceted map showing the top 30 largest ‘urban agglomerations’ from 1970 to 2030 based on population projects by the United Nations.
</p>
</div>
<p>The preceding code chunk demonstrates key features of faceted maps created with <strong>tmap</strong>:</p>
<ul>
<li>Shapes that do not have a facet variable are repeated (the countries in <code>world</code> in this case).</li>
<li>The <code>by</code> argument which varies depending on a variable (<code>year</code> in this case).</li>
<li><code>nrow</code>/<code>ncol</code> setting specifying the number of rows and columns that facets should be arranged into.</li>
<li>The <code>free.coords</code>-parameter specifying if each map has its own bounding box.</li>
</ul>
<p>In addition to their utility for showing changing spatial relationships, faceted maps are also useful as the foundation for animated maps (see <a href="adv-map.html#animated-maps">9.3</a>).</p>
</div>
<div id="inset-maps" class="section level3">
<h3><span class="header-section-number">9.2.7</span> Inset maps</h3>
<p>An inset map is a smaller map rendered within or next to the main map. <!-- I would say inset maps are usually used for the opposite. This is we have a specific area, say a mountain somewhere in Peru, and the inset map shows were in Peru the mountain is located, see Figure 3 in https://journal.r-project.org/archive/2017/RJ-2017-067/RJ-2017-067.pdf
and
http://wiki.gis.com/wiki/index.php/Inset_Map
So maybe it would be an idea to focus on the NZ Alps raster map as the main map and use NZ within the inset map.
Maybe this section is also a bit too long. How about shortening it, and maybe use the US example as a challenge in the exercise section.
--> Inset maps usually cover an area with densely located phenomena that cannot be clearly visible at the original map scale. They could be used to focus on a smaller area in more detail (Figure <a href="adv-map.html#fig:insetmap1">9.13</a>) or to bring some non-contiguous regions closer to ease their comparison (Figure <a href="adv-map.html#fig:insetmap2">9.14</a>). <!-- find the best distribution of insets 
In this section we focus on a creation of inset maps, so to learn about map styling go to section \@ref(aesthetics).
--></p>
<p>In the example below, we create an inset map of the central part of the New Zealand’s Southern Alps. The first step is to define the area of interest, which can be done by creating a new spatial object, <code>nz_region</code>. <!--# mapview::mapview(nz_height, native.crs = TRUE) or mapedit??--></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_region =<span class="st"> </span><span class="kw">st_bbox</span>(<span class="kw">c</span>(<span class="dt">xmin =</span> <span class="dv">1340000</span>, <span class="dt">xmax =</span> <span class="dv">1450000</span>, <span class="dt">ymin =</span> <span class="dv">5130000</span>, <span class="dt">ymax =</span> <span class="dv">5210000</span>),
                    <span class="dt">crs =</span> <span class="kw">st_crs</span>(nz_height)) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">st_as_sfc</span>() </code></pre></div>
<p>In the second step, we create a base map showing a lager area. It gives a context and helps to locate the area of interest. Importantly, this map needs to clearly indicate the location of the inset map, for example by stating its borders.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_map =<span class="st"> </span><span class="kw">tm_shape</span>(nz) +
<span class="st">  </span><span class="kw">tm_polygons</span>() +
<span class="st">  </span><span class="kw">tm_shape</span>(nz_height) +
<span class="st">  </span><span class="kw">tm_symbols</span>(<span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_shape</span>(nz_region) +
<span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">lwd =</span> <span class="dv">3</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The third step consists of the inset map creation. This is a place where the most important message is stated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_height_map =<span class="st"> </span><span class="kw">tm_shape</span>(nz_elev, <span class="dt">bbox =</span> tmaptools::<span class="kw">bb</span>(nz_region)) +
<span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">style =</span> <span class="st">&quot;cont&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;-Spectral&quot;</span>,
            <span class="dt">auto.palette.mapping =</span> <span class="ot">FALSE</span>, <span class="dt">legend.show =</span> <span class="ot">FALSE</span>) +
<span class="st">  </span><span class="kw">tm_shape</span>(nz_height) +
<span class="st">  </span><span class="kw">tm_symbols</span>(<span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>)</code></pre></div>
<p>Finally, we combine the two maps. A viewport from the <strong>grid</strong> package can be used by stating a center location (<code>x</code> and <code>y</code>) and a size (<code>width</code> and <code>height</code>) of the inset map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(grid)
nz_map
<span class="kw">print</span>(nz_height_map, <span class="dt">vp =</span> grid::<span class="kw">viewport</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="dt">width =</span> <span class="fl">0.4</span>, <span class="dt">height =</span> <span class="fl">0.4</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:insetmap1"></span>
<img src="figures/insetmap1-1.png" alt="Inset map showing the central part of the Southern Alps in New Zealand." width="576" />
<p class="caption">
Figure 9.13: Inset map showing the central part of the Southern Alps in New Zealand.
</p>
</div>
<p>Inset map can be save to file either by using a graphic device (see section <a href="read-write.html#visual-outputs">6.6</a>) or the <code>tmap_save()</code> function and its arguments - <code>insets_tm</code> and <code>insets_vp</code>.</p>
<p>Inset maps are also used to create one map of non-contiguous areas. Probably, the most often use example is a map of United States, which consists of the contiguous United States, Hawaii and Alaska. It is very important to find the best projection for each individual inset in this type of cases (see section <a href="transform.html#reproj-geo-data">5.2</a> to learn more). We can use US National Atlas Equal Area for the map of the contiguous United States by putting its EPSG code in the <code>projection</code> argument of <code>tm_shape()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_map =<span class="st"> </span><span class="kw">tm_shape</span>(us_states, <span class="dt">projection =</span> <span class="dv">2163</span>) +
<span class="st">  </span><span class="kw">tm_polygons</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The rest of our objects, <code>hawaii</code> and <code>alaska</code>, already have proper projections, therefore we just need to create two separate maps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hawaii_map =<span class="st"> </span><span class="kw">tm_shape</span>(hawaii) +
<span class="st">  </span><span class="kw">tm_polygons</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&quot;Hawaii&quot;</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>, <span class="dt">bg.color =</span> <span class="ot">NA</span>, 
            <span class="dt">title.position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>))
alaska_map =<span class="st"> </span><span class="kw">tm_shape</span>(alaska) +
<span class="st">  </span><span class="kw">tm_polygons</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&quot;Alaska&quot;</span>, <span class="dt">frame =</span> <span class="ot">FALSE</span>, <span class="dt">bg.color =</span> <span class="ot">NA</span>)</code></pre></div>
<p>The final map is created by combining and arranging these three maps:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_map
<span class="kw">print</span>(hawaii_map, <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">x =</span> <span class="fl">0.4</span>, <span class="dt">y =</span> <span class="fl">0.1</span>, <span class="dt">width =</span> <span class="fl">0.2</span>, <span class="dt">height =</span> <span class="fl">0.1</span>))
<span class="kw">print</span>(alaska_map, <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">x =</span> <span class="fl">0.15</span>, <span class="dt">y =</span> <span class="fl">0.15</span>, <span class="dt">width =</span> <span class="fl">0.3</span>, <span class="dt">height =</span> <span class="fl">0.3</span>))</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:insetmap2"></span>
<img src="figures/insetmap2-1.png" alt="Map of the United States." width="576" />
<p class="caption">
Figure 9.14: Map of the United States.
</p>
</div>
<p>The code presented above is very compact and allows for creation of many similar maps, however the map do not represent sizes and locations of Hawaii and Alaska well. You can see an alternative approach in the <a href="https://github.com/Robinlovelace/geocompr/blob/master/vignettes/us-map.Rmd"><code>vignettes/us-map.Rmd</code></a> file in the book’s GitHub repo, which tries to mitigate this issues.</p>
<!-- extended info about using tm_layout to show legend in main plot and remove it in the others -->
<p>The main goal of this section is to present how to generate and arrange inset maps. The next step is to use the knowledge from the previous sections to improve the map style or to add another data layers. Moreover, the same skills can be applied to combine maps and plots.</p>
</div>
</div>
<div id="animated-maps" class="section level2">
<h2><span class="header-section-number">9.3</span> Animated maps</h2>
<p>Faceted maps, described in <a href="adv-map.html#faceted-maps">9.2.6</a>, provide a way of showing how spatial relationships vary but the approach has disadvantages. Facets become tiny when many of them are squeezed into a single plot, potentially hiding <em>any</em> spatial relationships. Furthermore the fact that each facet is separated by space on the screen or page means that subtle differences between facets can be hard to detect.</p>
<p>With an increasing proportion of communication happening via digital screens, animated maps are becoming more popular. Animated maps can even be useful for paper reports: you can always link readers to a web-page containing an animated (or interactive) version of a printed map to help make it come alive.</p>
<p>Figure <a href="adv-map.html#fig:urban-animated">9.15</a> is a simple example of an animated map. Unlike the faceted plot it does not squeeze multiple maps into a single screen and allows the reader to see how the spatial distribution of the worlds most populous agglomerations evolve over time (see the book’s website for the animated version).</p>
<div class="figure" style="text-align: center"><span id="fig:urban-animated"></span>
<img src="figures/urban-animated.gif" alt="Animated map showing the top 30 largest 'urban agglomerations' from 1950 to 2030 based on population projects by the United Nations."  />
<p class="caption">
Figure 9.15: Animated map showing the top 30 largest ‘urban agglomerations’ from 1950 to 2030 based on population projects by the United Nations.
</p>
</div>
<p>The animated map illustrated in Figure <a href="adv-map.html#fig:urban-animated">9.15</a> can be created using the same <strong>tmap</strong> techniques that generates faceted maps, demonstrated in section <a href="adv-map.html#faceted-maps">9.2.6</a>. There are two differences, however, related to arguments in <code>tm_facets()</code>:</p>
<ul>
<li><code>free.coords = FALSE</code>, which maintains the map extent for each map iteration</li>
<li><code>nrow = 1</code> and <code>ncol = 1</code> ensure only one facet is created per year</li>
</ul>
<p>These additional arguments are demonstrated in the subsequent code chunk:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">urb_anim =<span class="st"> </span><span class="kw">tm_shape</span>(world) +
<span class="st">  </span><span class="kw">tm_polygons</span>() +<span class="st"> </span>
<span class="st">  </span><span class="kw">tm_shape</span>(urban_agglomerations) +
<span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="st">&quot;population_millions&quot;</span>) +
<span class="st">  </span><span class="kw">tm_facets</span>(<span class="dt">by =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">free.coords =</span> <span class="ot">FALSE</span>, <span class="dt">nrow =</span> <span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">1</span>)</code></pre></div>
<p>The resulting <code>urb_anim</code> represents a set of separate maps for each year. The final stage is to combine them and save the result as a <code>.gif</code> file with <code>tmap_animation()</code>. The following command creates the animation illustrated in Figure <a href="adv-map.html#fig:urban-animated">9.15</a>, with a few elements missing, that we will add-in during the exercises:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tmap_animation</span>(urb_anim, <span class="dt">filename =</span> <span class="st">&quot;urb_anim.gif&quot;</span>, <span class="dt">delay =</span> <span class="dv">25</span>)</code></pre></div>
<p>Another illustration of the power of animated maps is provided in Figure <a href="adv-map.html#fig:animus">9.16</a>. This shows the development of states in United States, which first formed in the East and then incrementally to the West and finally into the interior. Code to reproduce this map can be found in the script <code>09-usboundaries.R</code>.</p>
<div class="figure" style="text-align: center"><span id="fig:animus"></span>
<img src="https://user-images.githubusercontent.com/1825120/38543030-5794b6f0-3c9b-11e8-9da9-10ec1f3ea726.gif" alt="Animated map showing population growth and state formation and boundary changes in the United States, 1790-2010."  />
<p class="caption">
Figure 9.16: Animated map showing population growth and state formation and boundary changes in the United States, 1790-2010.
</p>
</div>
</div>
<div id="interactive-maps" class="section level2">
<h2><span class="header-section-number">9.4</span> Interactive maps</h2>
<p>The easiest way to create an interactive map to view spatial data in R is with the <strong>mapview</strong> package, as illustrated in the following ‘one liner’:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mapview::<span class="kw">mapview</span>(nz)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:mapview"></span>
<div id="htmlwidget-ec897849c5c50a6f7846" style="width:576px;height:355.968px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-ec897849c5c50a6f7846">{"x":{"options":{"minZoom":1,"maxZoom":100,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",1,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter",2,"CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",3,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",4,"Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenTopoMap",5,"OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addPolygons","args":[[[[{"lng":[174.616638800656,174.562809050564,174.481748333157,174.338965900234,174.214573266902,174.128772750479,174.045997583891,174.095972133855,174.155368483074,174.181866683395,174.135350500256,174.040527550541,173.983675883808,173.86604691657,173.688098133553,173.365180583183,173.356613017331,173.054243634031,173.130559999733,173.168093182624,173.167447217184,173.081005749918,172.851222917828,172.653880649817,172.69995103369,172.793065450767,172.869035233581,173.014442316542,172.984791449998,173.025130983722,173.120204417268,173.199324916413,173.280772883247,173.214814899913,173.288398249192,173.340087699738,173.286914883417,173.429163483407,173.389709633848,173.43403079967,173.535566349955,173.562634800269,173.644032483284,173.701142200014,173.74008500064,173.841272884062,173.931277716701,173.963284550175,174.078539632729,174.079958382619,174.125462949978,174.28978491699,174.350169531639,174.339655300127,174.468392016881,174.474719383801,174.536753999552,174.50237205005,174.557601466643,174.555188500026,174.485563450384,174.42268665044,174.404830266529,174.500809283377,174.460144966703,174.510000500399,174.589780900475,174.616638800656],"lat":[-36.1175604665931,-36.1790001827569,-36.2282769999411,-36.3168297168814,-36.2587116660842,-36.1736123994487,-36.1701695501245,-36.2448879334642,-36.2760972327256,-36.3630358998114,-36.3920499169095,-36.3928830666096,-36.2337049996773,-36.0912001162441,-35.8924174497112,-35.5474016995122,-35.5228177334182,-35.1912381663484,-35.1789323328505,-35.1364273327493,-35.0363686494584,-34.8923919496606,-34.6297133663182,-34.4780076502037,-34.4263823994855,-34.4539942827601,-34.4145187168343,-34.4241368998054,-34.5278073326595,-34.6535190997575,-34.81668376714,-34.870968849818,-34.8925261172536,-34.9612557667465,-35.0132316332065,-34.9582312164506,-34.8634985660914,-34.8251486160696,-34.9534963329236,-34.9859361497159,-34.9984530665273,-34.921567966528,-34.9661940829229,-34.9524767161151,-35.0372064834482,-34.9943093161935,-35.0472986498438,-35.1188625998023,-35.1161315001253,-35.2730977500874,-35.2940340332248,-35.2751480001439,-35.3264187489317,-35.3768799004023,-35.490753766877,-35.5563464661221,-35.5876817834851,-35.6408338001947,-35.7240167331044,-35.8608910000564,-35.786374216361,-35.784832099836,-35.8310155171749,-35.8410631829848,-35.9145349498182,-36.0304654495667,-36.0481898660492,-36.1175604665931]}]],[[{"lng":[175.291304133085,175.152091033439,175.141120333576,175.048242617196,174.990258082555,174.868951232796,174.815488049849,174.659628367495,174.538637882794,174.627048466479,174.690634167279,174.73950153409,174.857652450143,174.826874817006,174.744100215986,174.681552100084,174.583827667051,174.48303651745,174.468611433661,174.424401866458,174.273615083721,174.16870360025,174.187919333768,174.235835399823,174.312745950162,174.404776383887,174.43132198402,174.414885550516,174.25745998445,174.257569883856,174.373455166346,174.481748333157,174.562809050564,174.616638800656,174.657346033553,174.745751216322,174.818184083076,174.734791817454,174.723020317237,174.6928154505,174.740610167352,174.775982149355,174.735215883483,174.880847016882,174.95133831739,175.055796349565,175.093513100132,175.194032000506,175.28332898404,175.291304133085],"lat":[-37.0240384665172,-37.0215583499183,-37.175603383291,-37.1822711996281,-37.2165854996348,-37.2449866002391,-37.2286308828648,-37.2924320832073,-37.0766324001782,-37.0367340832541,-37.1366490000563,-37.1262254668378,-37.0510942830302,-37.0129061168963,-36.9843338828504,-36.9338147160346,-37.0073111163499,-37.0480030494167,-36.9540757993866,-36.8242195164721,-36.6113436505545,-36.4944308500355,-36.4344940164907,-36.4280906168391,-36.5364925994457,-36.6242364999802,-36.5110054662043,-36.4036616161859,-36.3809034491112,-36.3259556823754,-36.3194753664587,-36.2282769999411,-36.1790001827569,-36.1175604665931,-36.1775323830102,-36.2569215827706,-36.2852678662079,-36.4030681168164,-36.5128217502045,-36.5757347661745,-36.6480035493648,-36.7735064498795,-36.8411249497158,-36.8523293329412,-36.8953845498422,-36.882600599391,-36.9457113831059,-36.934308932921,-36.9885057501472,-37.0240384665172]}],[{"lng":[175.397381334664,175.42270826654,175.48369956673,175.479485900625,175.5432121837,175.525421999774,175.437765849463,175.433490317009,175.350243184351,175.364852117959,175.326193733308,175.341795483261,175.397381334664],"lat":[-36.0497132993229,-36.1291887990059,-36.1921515500045,-36.2444036833781,-36.2952009834002,-36.3476168495328,-36.3075231663546,-36.2724128496224,-36.228536449767,-36.182237616875,-36.138272981851,-36.0685923493946,-36.0497132993229]}],[{"lng":[175.172594933364,175.14511235048,175.066499350382,175.038030716822,175.172594933364],"lat":[-36.7386591493628,-36.8474120331354,-36.8337360501076,-36.7957700665624,-36.7386591493628]}]],[[{"lng":[175.940104000404,175.913492216935,175.832775867558,175.809667417205,175.833586717065,175.927714949317,175.905873816583,175.97718783329,175.940945834189,176.075603717482,176.076019150589,176.150334834187,176.232057866463,176.297547798202,176.390623467124,176.429143533873,176.505324767157,176.450980499877,176.255113766944,176.25838093416,176.257562950888,176.147549683454,176.172753900527,176.085669116788,175.989206866079,175.96436554996,175.885970716459,175.81256880052,175.669211766575,175.557854216472,175.634656366175,175.617972132813,175.682012417338,175.562633650262,175.579969833543,175.546438183897,175.574620149734,175.523386533046,175.632458999384,175.612185166049,175.480939533802,175.383212017291,175.317760016592,175.213231183619,175.10922668413,174.954390867085,174.937845033609,174.862896367393,174.791960217277,174.655191183282,174.615147466571,174.64557498284,174.634641616934,174.715704749268,174.712538232634,174.690774649571,174.777037133266,174.895569600305,174.874875616366,174.77780156729,174.792085916113,174.75679855049,174.843696184123,174.956284466653,174.951308116723,174.837134500703,174.768715216871,174.700024633059,174.659628367495,174.815488049849,174.868951232796,174.990258082555,175.048242617196,175.141120333576,175.152091033439,175.291304133085,175.294966566687,175.323006283065,175.3992043827,175.544902117386,175.514084716697,175.51974208322,175.491002617547,175.408398483484,175.490180517217,175.494676733872,175.429445151764,175.447073067326,175.405834634533,175.344544616922,175.328268300532,175.36819123307,175.520191916267,175.522613315882,175.583391316677,175.578198899777,175.646650566193,175.788850933098,175.708633783134,175.78130515032,175.856004517198,175.842233483927,175.888322383074,175.878370950751,175.940104000404],"lat":[-37.3732415493795,-37.4255867167681,-37.4716019831595,-37.5138131497333,-37.6274871173195,-37.7760034327579,-37.8285516669453,-37.9136730327822,-37.929422499792,-38.0495643996454,-38.1214420994107,-38.2181863994961,-38.2390825826552,-38.2295556169363,-38.3230470167692,-38.3134151167029,-38.4022137992992,-38.5616572327478,-38.8081781832656,-38.8899908831226,-38.9478759665031,-39.0376737001404,-39.0784858666215,-39.1294486168462,-39.11554808317,-39.1798030167947,-39.2058951834786,-39.3003262164755,-39.2969341494137,-39.2759983494818,-39.1583628832729,-39.0812491668439,-38.9797105002169,-38.986829699848,-38.9106842496516,-38.8598730996322,-38.8163002497041,-38.750091966835,-38.5917750671975,-38.4876116161861,-38.478880750128,-38.542295983231,-38.5560422670079,-38.6393990331454,-38.6245203666478,-38.6675035326548,-38.7501585666532,-38.7745840666622,-38.7317766330023,-38.7332825998921,-38.7066484493564,-38.4563665331151,-38.3871955160275,-38.3065037997069,-38.2005980662173,-38.1176242502238,-38.1325016493274,-38.0859713163665,-38.0485370834827,-38.0815316832065,-38.0072839664253,-37.8638128167999,-37.8039134660842,-37.7924118832134,-37.7515311835327,-37.7936627827116,-37.5608502999349,-37.4167737834823,-37.2924320832073,-37.2286308828648,-37.2449866002391,-37.2165854996348,-37.1822711996281,-37.175603383291,-37.0215583499183,-37.0240384665172,-37.1211146497524,-37.1906320164282,-37.2270412666345,-37.1573665495214,-37.0930035993838,-37.0341053993446,-36.9622664333688,-36.857511400251,-36.8083106669846,-36.7619687494618,-36.7001410820276,-36.6600482663062,-36.580563183098,-36.5530231170595,-36.4808005320916,-36.4685975823769,-36.5407973488788,-36.5918639497124,-36.6272173993718,-36.6802999496706,-36.7363723666233,-36.7041192832818,-36.8325179663713,-36.8224126992097,-36.9228085834167,-36.9474531172303,-37.0391867663686,-37.2003710496673,-37.3732415493795]}]],[[{"lng":[178.085284050728,178.107554900656,177.986683351023,177.996621683506,178.073006950406,177.972291633859,177.860967450149,177.739984233557,177.692067683864,177.604788567261,177.499270867144,177.463687900819,177.236922317683,177.257394033283,177.122170799827,177.045979500377,176.991448066662,176.87866763316,176.766746733651,176.717283066468,176.695970650021,176.601167800205,176.520452884071,176.468164783255,176.382140266511,176.303565400194,176.25838093416,176.255113766944,176.450980499877,176.505324767157,176.429143533873,176.390623467124,176.297547798202,176.232057866463,176.150334834187,176.076019150589,176.075603717482,175.940945834189,175.97718783329,175.905873816583,175.927714949317,175.833586717065,175.809667417205,175.832775867558,175.913492216935,175.940104000404,175.963443900663,175.93480529982,175.975048966786,176.053118300075,176.186754767108,176.250032000857,176.419017433436,176.477600450903,176.601950900424,176.736143750078,176.931668933866,177.083869783407,177.160565467584,177.383685833914,177.487534484142,177.5467901337,177.619619200774,177.683952433749,177.727635733791,177.868536417845,177.958640534434,178.006622349832,178.085284050728],"lat":[-37.5423911653952,-37.5987159651277,-37.6087571325392,-37.7602764990791,-37.7635896985385,-37.8450054654632,-38.1116561657724,-38.0420469662422,-38.1082775994784,-38.1866207660274,-38.2184667490582,-38.3335362661665,-38.4263417993583,-38.5082771658461,-38.5839209332306,-38.6208022327955,-38.693694583043,-38.6671346491991,-38.689309683067,-38.7245242994195,-38.8215917661477,-38.825559132932,-38.7968662995226,-38.9415194660224,-38.9887032828112,-38.9017194499202,-38.8899908831226,-38.8081781832656,-38.5616572327478,-38.4022137992992,-38.3134151167029,-38.3230470167692,-38.2295556169363,-38.2390825826552,-38.2181863994961,-38.1214420994107,-38.0495643996454,-37.929422499792,-37.9136730327822,-37.8285516669453,-37.7760034327579,-37.6274871173195,-37.5138131497333,-37.4716019831595,-37.4255867167681,-37.3732415493795,-37.4333808167205,-37.5368533661666,-37.6239334661018,-37.6595265664723,-37.634790017279,-37.6800395995794,-37.7484934665627,-37.7541410499537,-37.8295142667608,-37.8795955829941,-37.9168966999474,-37.9788140826354,-37.9898454662543,-37.9836964661637,-37.9495595659166,-37.9075796825578,-37.8107282995693,-37.7601537155194,-37.6801879490526,-37.6533825659818,-37.6053283322934,-37.5531278659688,-37.5423911653952]}]],[[{"lng":[177.898992867322,177.834796917381,177.799025000975,177.660163933681,177.660490067302,177.597522800508,177.49421208424,177.447906750195,177.353425167645,177.307560650033,177.122170799827,177.257394033283,177.236922317683,177.463687900819,177.499270867144,177.604788567261,177.692067683864,177.739984233557,177.860967450149,177.972291633859,178.073006950406,177.996621683506,177.986683351023,178.107554900656,178.085284050728,178.174634083746,178.276301851602,178.363710601162,178.482593484053,178.550373600413,178.415858017631,178.391299368031,178.337261951072,178.373593883376,178.321955168218,178.338370117511,178.312409501413,178.344519151294,178.281772317114,178.293040667099,178.198843133985,178.050040402505,177.9727296172,177.911783384436,177.898992867322],"lat":[-38.9718330659402,-38.9527794154328,-38.8943902994202,-38.9047009160675,-38.8489419157559,-38.8070414992073,-38.7779742826049,-38.6359438824164,-38.6245578660679,-38.659704199614,-38.5839209332306,-38.5082771658461,-38.4263417993583,-38.3335362661665,-38.2184667490582,-38.1866207660274,-38.1082775994784,-38.0420469662422,-38.1116561657724,-37.8450054654632,-37.7635896985385,-37.7602764990791,-37.6087571325392,-37.5987159651277,-37.5423911653952,-37.5346582985723,-37.5544868652179,-37.6310041980111,-37.6410965144209,-37.6920842484305,-37.8580439155172,-37.9613996652351,-38.0095467654096,-38.0944882317616,-38.1221914152638,-38.1917070816724,-38.2415486150003,-38.4184646319201,-38.4721755149837,-38.5269283319884,-38.6055091147978,-38.7020828317471,-38.6812606823481,-38.8279248659345,-38.9718330659402]}]],[[{"lng":[177.898992867322,177.901799650219,178.001674400697,177.924318566662,177.906174350275,177.850842016855,177.839268633525,177.870901817579,177.755965216565,177.636631149881,177.421363584153,177.259161701129,177.046117517326,176.989527483471,176.919394050427,176.876375366274,176.92417755026,176.922247883049,176.966353650084,177.075499034874,177.011022417483,177.005106232773,176.932128366633,176.888223216891,176.868997500466,176.794396933421,176.687031283282,176.622569049879,176.44329526638,176.359488317331,176.378605866561,176.323214066837,176.204970833785,176.136627349808,176.093831400639,176.106847067352,176.176852599749,176.195937933827,176.142726417603,176.183756817499,176.136827417622,176.111859467522,176.121760383432,176.080882450312,176.115201750033,176.085669116788,176.172753900527,176.147549683454,176.257562950888,176.25838093416,176.303565400194,176.382140266511,176.468164783255,176.520452884071,176.601167800205,176.695970650021,176.717283066468,176.766746733651,176.87866763316,176.991448066662,177.045979500377,177.122170799827,177.307560650033,177.353425167645,177.447906750195,177.49421208424,177.597522800508,177.660490067302,177.660163933681,177.799025000975,177.834796917381,177.898992867322],"lat":[-38.9718330659402,-39.0729589155023,-39.1049364824401,-39.1701287656029,-39.2262764647389,-39.2334497985144,-39.1523278981441,-39.0876976326241,-39.0586759157535,-39.0504614660947,-39.0626328989449,-39.1006631827984,-39.193936749739,-39.294002783693,-39.3400230828642,-39.4226607993692,-39.4759893488304,-39.549583649216,-39.6235120824413,-39.6732594152758,-39.7427146829718,-39.8359419163268,-39.9352899662693,-40.0255260159481,-40.1313829663584,-40.2053349995806,-40.2563932326417,-40.4280165160345,-40.4073888329473,-40.1971025164432,-40.1581407166381,-40.0937170161921,-40.0189951167237,-40.0285781338199,-39.9955025832323,-39.9172052496743,-39.7440490994983,-39.6635709665703,-39.584682783093,-39.5389751330716,-39.4752775332614,-39.3849908334062,-39.3263642668049,-39.2591636993616,-39.2176892164469,-39.1294486168462,-39.0784858666215,-39.0376737001404,-38.9478759665031,-38.8899908831226,-38.9017194499202,-38.9887032828112,-38.9415194660224,-38.7968662995226,-38.825559132932,-38.8215917661477,-38.7245242994195,-38.689309683067,-38.6671346491991,-38.693694583043,-38.6208022327955,-38.5839209332306,-38.659704199614,-38.6245578660679,-38.6359438824164,-38.7779742826049,-38.8070414992073,-38.8489419157559,-38.9047009160675,-38.8943902994202,-38.9527794154328,-38.9718330659402]}]],[[{"lng":[174.615147466571,174.655191183282,174.791960217277,174.862896367393,174.819869750297,174.798771383129,174.82803073341,174.764415417467,174.788411450134,174.675169549981,174.755642432479,174.747802983227,174.891668949943,174.871353583229,174.928495867377,174.967386967073,174.972628816641,174.930618333552,174.784081849931,174.716569950035,174.558874867369,174.444514817259,174.352709617041,174.201535516873,174.076819100748,173.910845583182,173.794988949217,173.75158500083,173.794817016681,173.909613299173,174.088957305084,174.200815833298,174.390964834124,174.559947483204,174.615147466571],"lat":[-38.7066484493564,-38.7332825998921,-38.7317766330023,-38.7745840666622,-38.7875171166264,-38.8652667999868,-38.9237043663331,-39.0047909500156,-39.0678331830497,-39.1298299493575,-39.2336436334958,-39.275799016305,-39.3582403665597,-39.4010654665755,-39.4761503161921,-39.4862796832709,-39.6531461001073,-39.7244787998992,-39.8579774497761,-39.8672062167726,-39.8174444664465,-39.7506608664393,-39.6590780832903,-39.5880837831519,-39.577339966687,-39.5148036332182,-39.4150641328021,-39.2803068998566,-39.1924945673089,-39.1211085998919,-39.0509301723833,-38.9883909501815,-38.988858083009,-38.8559135835186,-38.7066484493564]}]],[[{"lng":[176.085669116788,176.115201750033,176.080882450312,176.121760383432,176.111859467522,176.136827417622,176.183756817499,176.142726417603,176.195937933827,176.176852599749,176.106847067352,176.093831400639,176.136627349808,176.204970833785,176.323214066837,176.378605866561,176.359488317331,176.44329526638,176.622569049879,176.620793584036,176.493457017505,176.332762533486,176.211253483369,176.0823341834,176.022449299869,175.871636834195,175.764739183997,175.77010965014,175.690650115948,175.653222466794,175.473443566666,175.439643550552,175.371593716648,175.266658932695,175.136486700712,175.190707066476,175.227057750243,175.223560650608,175.198135366129,175.162540683897,175.045463016742,174.927877449905,174.784081849931,174.930618333552,174.972628816641,174.967386967073,174.928495867377,174.871353583229,174.891668949943,174.747802983227,174.755642432479,174.675169549981,174.788411450134,174.764415417467,174.82803073341,174.798771383129,174.819869750297,174.862896367393,174.937845033609,174.954390867085,175.10922668413,175.213231183619,175.317760016592,175.383212017291,175.480939533802,175.612185166049,175.632458999384,175.523386533046,175.574620149734,175.546438183897,175.579969833543,175.562633650262,175.682012417338,175.617972132813,175.634656366175,175.557854216472,175.669211766575,175.81256880052,175.885970716459,175.96436554996,175.989206866079,176.085669116788],"lat":[-39.1294486168462,-39.2176892164469,-39.2591636993616,-39.3263642668049,-39.3849908334062,-39.4752775332614,-39.5389751330716,-39.584682783093,-39.6635709665703,-39.7440490994983,-39.9172052496743,-39.9955025832323,-40.0285781338199,-40.0189951167237,-40.0937170161921,-40.1581407166381,-40.1971025164432,-40.4073888329473,-40.4280165160345,-40.4917772328785,-40.5305003326431,-40.6979007993168,-40.659210282768,-40.7081527159945,-40.7114886668177,-40.7779047333065,-40.7680905666746,-40.6988883998071,-40.6965623329528,-40.7424894826732,-40.6933970997204,-40.7441521327034,-40.7268607829925,-40.7686105330731,-40.7003334997973,-40.5669227160378,-40.3980753833572,-40.2930346163099,-40.1765422327651,-40.1071686333906,-39.9854570661082,-39.8993730493272,-39.8579774497761,-39.7244787998992,-39.6531461001073,-39.4862796832709,-39.4761503161921,-39.4010654665755,-39.3582403665597,-39.275799016305,-39.2336436334958,-39.1298299493575,-39.0678331830497,-39.0047909500156,-38.9237043663331,-38.8652667999868,-38.7875171166264,-38.7745840666622,-38.7501585666532,-38.6675035326548,-38.6245203666478,-38.6393990331454,-38.5560422670079,-38.542295983231,-38.478880750128,-38.4876116161861,-38.5917750671975,-38.750091966835,-38.8163002497041,-38.8598730996322,-38.9106842496516,-38.986829699848,-38.9797105002169,-39.0812491668439,-39.1583628832729,-39.2759983494818,-39.2969341494137,-39.3003262164755,-39.2058951834786,-39.1798030167947,-39.11554808317,-39.1294486168462]}]],[[{"lng":[176.332762533486,176.26722840018,176.224487017581,176.154899234063,176.10692563345,176.062479416918,176.003310849803,175.961835883779,175.899294816757,175.811865650044,175.675583900734,175.585185949959,175.533100033117,175.433381416302,175.325406533484,175.236423100173,175.195284183578,175.216735033403,175.043268483566,174.924173882771,174.847847867082,174.912076183578,174.844356367019,174.785921437228,174.839045832862,174.705109599961,174.66078746668,174.623012999722,174.711288199763,174.794672150245,174.867167799271,174.846312016586,174.938811199179,174.989772533759,175.035492733743,175.136486700712,175.266658932695,175.371593716648,175.439643550552,175.473443566666,175.653222466794,175.690650115948,175.77010965014,175.764739183997,175.871636834195,176.022449299869,176.0823341834,176.211253483369,176.332762533486],"lat":[-40.6979007993168,-40.7848635999896,-40.9064747167747,-40.9481505494893,-41.015220899261,-41.1310157497801,-41.1717069160291,-41.2447749000527,-41.2632956998994,-41.359626999291,-41.4137952330452,-41.4873728326723,-41.4965452334319,-41.5688357168968,-41.6059589661651,-41.6051656500414,-41.5238026326864,-41.4315767334039,-41.3733172995629,-41.4347028666894,-41.3594841327896,-41.259709699891,-41.2288581497332,-41.2651837993373,-41.3252582662544,-41.3571104667103,-41.3403752330376,-41.2603256333459,-41.219934017264,-41.124690299725,-41.0867387663858,-41.0499113660342,-41.000301466556,-40.8786943168829,-40.8516626997137,-40.7003334997973,-40.7686105330731,-40.7268607829925,-40.7441521327034,-40.6933970997204,-40.7424894826732,-40.6965623329528,-40.6988883998071,-40.7680905666746,-40.7779047333065,-40.7114886668177,-40.7081527159945,-40.659210282768,-40.6979007993168]}]],[[{"lng":[172.479030949819,172.444256900204,172.348260516018,172.235513800302,172.1330007499,172.094375383646,171.974953333456,171.915639166648,171.841774433461,171.763848766853,171.746369750712,171.69066966728,171.44922653414,171.411630450039,171.316264849941,171.237669015979,171.197689267427,171.079330766508,170.993271149153,170.937214367317,170.830348166594,170.70569891615,170.592312017226,170.528889117364,170.395291850712,170.32286143405,170.23842121714,170.098131417276,170.091407749956,169.965530866422,169.900034783341,169.699336634174,169.592780550647,169.591375933139,169.37295708232,169.275178699696,169.188798133344,169.147102432497,168.975078451222,168.963356499608,168.849166000645,168.836083533033,168.728392349424,168.625502800125,168.460041532958,168.334527917476,168.407363599041,168.349075433281,168.347349199204,168.224958950513,168.131928965928,168.052080299808,168.245224000369,168.327532100509,168.386086599287,168.512572866295,168.59603308294,168.709528882891,168.815458849998,168.888444333017,168.969334415799,169.209384000748,169.426815166877,169.591670650551,169.690794066995,169.793601633191,169.981233500258,170.050894783885,170.26610145036,170.257309000666,170.34165461676,170.420541400347,170.524388600502,170.720963766414,170.867846066505,170.947971800697,171.051014333038,171.167346766778,171.218172099769,171.304561750154,171.321142133862,171.417931516559,171.455980199127,171.462321733037,171.587717983286,171.670754701712,171.828431383484,171.882088466121,171.987652299441,172.063382449494,172.092597800296,172.111628817585,172.094501582949,172.133988150577,172.217804650849,172.229036100221,172.370078216958,172.310335033614,172.493938299216,172.485968450507,172.618004983595,172.657937583202,172.600312034113,172.584361567505,172.46311268413,172.418018282578,172.34245996745,172.320665484129,172.238130649319,172.247078967484,172.129322299744,172.115730567145,172.052126816993,172.135203666157,172.206730749948,172.26099479982,172.331950216583,172.335875833233,172.369593532568,172.479030949819],"lat":[-42.2770294330973,-42.3659640998669,-42.3913898493633,-42.4567272663168,-42.5552061664139,-42.6204476501481,-42.6389925162904,-42.6817304496134,-42.7745563165321,-42.7917224165001,-42.8740807000281,-42.9008274327434,-42.9092283835179,-42.9507592166428,-42.9474959831847,-43.0025114832403,-43.0742574837236,-43.1023006501349,-43.2153140831952,-43.2040572826411,-43.2835111333203,-43.3207865163813,-43.4340141666261,-43.4103522167365,-43.4980506000427,-43.4903493000688,-43.5138270161525,-43.5954793832756,-43.6603731667768,-43.7917623165151,-43.8129979661406,-43.9635462830298,-43.9580761661512,-44.0125360167186,-44.1169906665293,-44.0985810000811,-44.1105468990999,-44.0802167656571,-44.1440294836209,-44.1999363326238,-44.2466723492225,-44.3399177497125,-44.4194781165777,-44.4339354660492,-44.4953348155298,-44.4967794321351,-44.3751147821832,-44.3304823991759,-44.2842383160426,-44.256824249116,-44.2811937815188,-44.2586477653813,-44.158056415825,-44.0494656159258,-44.0035227657058,-44.0018953495409,-43.9725449323756,-43.9942465493971,-43.9674074832386,-43.9053743496898,-43.8784611496635,-43.7192993998752,-43.6253148328527,-43.5990183994978,-43.5430910165578,-43.4215250501236,-43.3578198495134,-43.2918990001713,-43.1725636158292,-43.118815349405,-43.0966792499658,-43.0361614328878,-43.0173943501588,-42.9301012999008,-42.8228048660163,-42.7232656999317,-42.650688316626,-42.5078089999748,-42.381019766233,-42.2672141667491,-42.1532471998875,-41.9177566328862,-41.8824885829382,-41.7497772332867,-41.7299331833162,-41.7398889758282,-41.6470442500116,-41.6006758828465,-41.4457266661726,-41.3840702160756,-41.282779150182,-41.0257784662432,-40.916250083059,-40.850621782872,-40.7745427669185,-40.8558806664281,-40.9707524671654,-41.0135581163012,-41.0245242002173,-41.0542427327216,-41.1598956494134,-41.239168999544,-41.3018332326605,-41.3761944999689,-41.4043775665175,-41.4716592493225,-41.5131613498026,-41.6102873667673,-41.6395180999627,-41.6842177167088,-41.7140016329438,-41.8684047996669,-41.9451821329784,-42.1040439833797,-42.0983147832165,-42.1483124834312,-42.1506392829313,-42.2342079660356,-42.2806025168152,-42.2770294330973]}]],[[{"lng":[174.048786900106,173.966599600681,173.892544684064,173.697996616623,173.671647083024,173.594467415865,173.509134350058,173.479398800221,173.368425849937,173.241651783235,173.14498353365,173.080542450878,172.816906899328,172.73369503355,172.704087800548,172.71511108423,172.776007199763,173.040053516148,173.102133650692,173.130149783874,173.100509666792,172.997729132882,172.836626966534,172.728520416444,172.587602799177,172.31661868302,172.028047117075,171.614830016684,171.439070166985,171.333436083013,171.244871200256,171.258240632397,171.195791149222,171.159184499413,171.167954350424,171.144153632672,170.882433150378,170.658825416631,170.636873433878,170.542436216334,170.447188600346,170.397211283579,170.349440716735,170.373258400944,170.319353066232,170.242072667457,170.094098767271,169.996618083497,169.944216317567,169.836191183419,169.757151799335,169.64421074906,169.633685649884,169.545884367477,169.57710081663,169.571069933865,169.717037416418,169.699336634174,169.900034783341,169.965530866422,170.091407749956,170.098131417276,170.23842121714,170.32286143405,170.395291850712,170.528889117364,170.592312017226,170.70569891615,170.830348166594,170.937214367317,170.993271149153,171.079330766508,171.197689267427,171.237669015979,171.316264849941,171.411630450039,171.44922653414,171.69066966728,171.746369750712,171.763848766853,171.841774433461,171.915639166648,171.974953333456,172.094375383646,172.1330007499,172.235513800302,172.348260516018,172.444256900204,172.479030949819,172.614713433524,172.639183050117,172.721472999322,172.7216385824,172.823290099099,172.84243633332,172.914144833248,172.94139345023,172.992906316788,173.035789000756,173.189895532864,173.24452471748,173.312201366903,173.464463350147,173.499107499943,173.720210166329,173.744379950814,173.817253667021,173.955504883873,174.048786900106],"lat":[-41.9681092162602,-42.0447000162179,-42.1892206160492,-42.351055932752,-42.4129525826766,-42.4284450167963,-42.5056333005085,-42.5927161833235,-42.7988198827098,-42.9528653661342,-42.9864308666799,-43.0507309163767,-43.1332584499924,-43.2550360161747,-43.3903552166591,-43.5479150830848,-43.5827193327987,-43.6552001167613,-43.6956743333843,-43.7627759999547,-43.8318133828848,-43.8873741827115,-43.889760282991,-43.8276729498285,-43.833265216244,-43.8670884165103,-43.9583162998763,-44.1318285168766,-44.2233021661649,-44.295190716563,-44.3817173993977,-44.4457059831022,-44.5267523667591,-44.627834699927,-44.8761730664257,-44.9403990326591,-44.891009399824,-44.9092402835359,-44.9513015836188,-44.9850467672132,-45.0659566666071,-45.0809043667793,-45.0216976998576,-44.9527760160294,-44.9030489828245,-44.9307172500278,-44.9400199334535,-44.8215735833956,-44.6539842168145,-44.6688994160923,-44.6121328159957,-44.5858154997107,-44.4624052998829,-44.4226623995998,-44.3456657831464,-44.1772291499773,-44.0382773159809,-43.9635462830298,-43.8129979661406,-43.7917623165151,-43.6603731667768,-43.5954793832756,-43.5138270161525,-43.4903493000688,-43.4980506000427,-43.4103522167365,-43.4340141666261,-43.3207865163813,-43.2835111333203,-43.2040572826411,-43.2153140831952,-43.1023006501349,-43.0742574837236,-43.0025114832403,-42.9474959831847,-42.9507592166428,-42.9092283835179,-42.9008274327434,-42.8740807000281,-42.7917224165001,-42.7745563165321,-42.6817304496134,-42.6389925162904,-42.6204476501481,-42.5552061664139,-42.4567272663168,-42.3913898493633,-42.3659640998669,-42.2770294330973,-42.1954626498809,-42.1007946829437,-42.1034917994101,-42.1586981838795,-42.2047070167512,-42.2891840664509,-42.3086089000751,-42.3778250335143,-42.403849533931,-42.4834705328707,-42.4105463995019,-42.3031041161546,-42.2503815996964,-42.1956736999014,-42.0787366833871,-41.9607712162466,-41.9073832665075,-41.9329969833512,-41.9126783171065,-41.9681092162602]}]],[[{"lng":[169.699336634174,169.717037416418,169.571069933865,169.57710081663,169.545884367477,169.633685649884,169.64421074906,169.757151799335,169.836191183419,169.944216317567,169.996618083497,170.094098767271,170.242072667457,170.319353066232,170.373258400944,170.349440716735,170.397211283579,170.447188600346,170.542436216334,170.636873433878,170.658825416631,170.882433150378,171.144153632672,171.100528099082,170.973751149775,170.904456867088,170.831473232453,170.831145883379,170.75579789982,170.725243549953,170.653058832419,170.600894433298,170.658593699998,170.663784716406,170.511765316615,170.297526650458,170.196885316546,170.168560666665,169.923941867019,169.79808831661,169.797051965838,169.587586633505,169.47711816663,169.404843300523,169.279166266453,169.200940883195,169.250660233525,169.172959832967,169.195997516664,169.134143867521,169.190826583093,169.198060700805,169.1596198997,169.153328134266,169.067252783316,169.091515616612,169.005199499322,168.993372050566,169.129045084135,169.140231617244,169.211048582457,169.099293033043,169.065469000311,168.959565366312,168.886900132632,168.782457032387,168.75163494987,168.69221520076,168.674105117547,168.539401383192,168.323294050019,168.300759133521,168.217006499085,168.284206182761,168.292267949593,168.133993850181,168.117214416596,168.191001933458,168.172333383406,168.234509800005,168.334527917476,168.460041532958,168.625502800125,168.728392349424,168.836083533033,168.849166000645,168.963356499608,168.975078451222,169.147102432497,169.188798133344,169.275178699696,169.37295708232,169.591375933139,169.592780550647,169.699336634174],"lat":[-43.9635462830298,-44.0382773159809,-44.1772291499773,-44.3456657831464,-44.4226623995998,-44.4624052998829,-44.5858154997107,-44.6121328159957,-44.6688994160923,-44.6539842168145,-44.8215735833956,-44.9400199334535,-44.9307172500278,-44.9030489828245,-44.9527760160294,-45.0216976998576,-45.0809043667793,-45.0659566666071,-44.9850467672132,-44.9513015836188,-44.9092402835359,-44.891009399824,-44.9403990326591,-45.0030083668204,-45.0991354496319,-45.1744155169177,-45.3055600328457,-45.4735115163131,-45.533487850182,-45.5959489167521,-45.6310545499492,-45.7107696833387,-45.7588499501258,-45.9035087330227,-45.9091708334692,-45.9623933001436,-46.0625319333419,-46.1545419164646,-46.2983543337638,-46.3546976164324,-46.4513536993082,-46.5657448492693,-46.5613084166797,-46.6123262493729,-46.6224137665975,-46.5607098326622,-46.5143265831323,-46.4861186661636,-46.4044065824797,-46.3754392329164,-46.3264038991747,-46.2126295490888,-46.1756371497824,-46.0487447159179,-45.9804276161464,-45.8825561162821,-45.8634921996335,-45.7285384164748,-45.5203341824305,-45.4652520827241,-45.4167719991232,-45.319945749245,-45.269609899731,-45.3591220827466,-45.4628204656639,-45.4370390829242,-45.3675663491687,-45.3396697495697,-45.2430717491471,-45.3093267162083,-45.327543165947,-45.2246531159516,-45.1445409488356,-45.1061745325468,-45.0438246323005,-44.9414410656498,-44.8714499484676,-44.7667900988546,-44.7045591824468,-44.543195698814,-44.4967794321351,-44.4953348155298,-44.4339354660492,-44.4194781165777,-44.3399177497125,-44.2466723492225,-44.1999363326238,-44.1440294836209,-44.0802167656571,-44.1105468990999,-44.0985810000811,-44.1169906665293,-44.0125360167186,-43.9580761661512,-43.9635462830298]}]],[[{"lng":[168.334527917476,168.234509800005,168.172333383406,168.191001933458,168.117214416596,168.133993850181,168.292267949593,168.284206182761,168.217006499085,168.300759133521,168.323294050019,168.539401383192,168.674105117547,168.69221520076,168.75163494987,168.782457032387,168.886900132632,168.959565366312,169.065469000311,169.099293033043,169.211048582457,169.140231617244,169.129045084135,168.993372050566,169.005199499322,169.091515616612,169.067252783316,169.153328134266,169.1596198997,169.198060700805,169.190826583093,169.134143867521,169.195997516664,169.172959832967,169.250660233525,169.200940883195,169.279166266453,169.220365916036,169.112977633974,169.005877783165,168.847240616748,168.793966399727,168.602963450817,168.515573883457,168.352956367785,168.265940500354,168.263609712926,168.190226400186,168.064940999915,168.015834933966,167.93185776713,167.783985416635,167.697388534619,167.712351200166,167.611463133841,167.533283266975,167.403100267612,167.360417901081,167.21721350111,167.105668635801,166.852483269489,166.778670303253,166.657467519732,166.618782638105,166.68276642128,166.698540019365,166.615138537561,166.611146487314,166.555778437685,166.449630289541,166.426302922672,166.450324487655,166.518401055545,166.622173086985,166.804038752399,166.730721587317,166.751807818911,166.731030037296,166.671602286539,166.684135137044,166.844406784828,166.908979302293,167.007590901768,166.967797184775,167.002267434006,167.271321767837,167.500637450702,167.571723434454,167.751370433439,167.817211300363,167.827906550695,167.872684933483,167.973286216925,168.008558300361,168.097524283348,168.052080299808,168.131928965928,168.224958950513,168.347349199204,168.349075433281,168.407363599041,168.334527917476],"lat":[-44.4967794321351,-44.543195698814,-44.7045591824468,-44.7667900988546,-44.8714499484676,-44.9414410656498,-45.0438246323005,-45.1061745325468,-45.1445409488356,-45.2246531159516,-45.327543165947,-45.3093267162083,-45.2430717491471,-45.3396697495697,-45.3675663491687,-45.4370390829242,-45.4628204656639,-45.3591220827466,-45.269609899731,-45.319945749245,-45.4167719991232,-45.4652520827241,-45.5203341824305,-45.7285384164748,-45.8634921996335,-45.8825561162821,-45.9804276161464,-46.0487447159179,-46.1756371497824,-46.2126295490888,-46.3264038991747,-46.3754392329164,-46.4044065824797,-46.4861186661636,-46.5143265831323,-46.5607098326622,-46.6224137665975,-46.6562230996031,-46.6445697995773,-46.6743386327922,-46.6586199324697,-46.581126249587,-46.5519047491435,-46.5742984494303,-46.536278198365,-46.5559335316574,-46.4953184330149,-46.3853629156488,-46.3392979653123,-46.3838269816428,-46.3581014984449,-46.3890891153421,-46.3079614649503,-46.2576959484531,-46.1914227639541,-46.1624094643935,-46.1520754139566,-46.2369483973937,-46.2625064636042,-46.2536611290707,-46.208479478094,-46.2220721780732,-46.2022869439588,-46.1487916607235,-46.1155054774682,-46.0582340943939,-46.0600605774594,-45.9997223441552,-45.974646443428,-45.9949010433078,-45.9044508925509,-45.8189640767231,-45.7943900103485,-45.7910534108493,-45.7598318118677,-45.7281351117593,-45.6676932449173,-45.5947802620528,-45.5749929274641,-45.5132728112309,-45.2758819118717,-45.3074377122482,-45.3141696626352,-45.1937010798687,-45.1255542132859,-44.8704800972672,-44.748057897824,-44.6858730808973,-44.5806611478559,-44.5991209981649,-44.5075593480495,-44.4342743651316,-44.3866309813592,-44.3250568982168,-44.3271642985448,-44.2586477653813,-44.2811937815188,-44.256824249116,-44.2842383160426,-44.3304823991759,-44.3751147821832,-44.4967794321351]}],[{"lng":[167.869696717386,167.976547566978,168.001210732732,168.141792199565,168.141009318344,168.031908184531,167.978834600349,168.150523284284,168.21466859946,168.156390867238,167.954351351045,167.825699752283,167.710747199939,167.636122350701,167.64603149998,167.466622085851,167.466427318386,167.575995201712,167.579121551345,167.64975053312,167.694039967428,167.759027316278,167.756471367387,167.704121801107,167.754640633164,167.869696717386],"lat":[-46.6842310150475,-46.7237613973466,-46.7857626640377,-46.8618585317734,-46.9094082979053,-46.89688748132,-46.9288782319926,-46.9664681167307,-46.9944344827427,-47.1041435150793,-47.1292745634624,-47.191379982114,-47.1604565144884,-47.2102895310388,-47.2637216303122,-47.2828524134173,-47.2165166300209,-47.166243313737,-47.085338897629,-47.0364652468971,-46.9670829976916,-46.9370851803384,-46.8609822636435,-46.7544420145734,-46.6946847146376,-46.6842310150475]}],[{"lng":[166.678832287015,166.716482704068,166.723640187457,166.684653836759,166.588378970674,166.53680382096,166.678832287015],"lat":[-45.6003755947174,-45.6245835280225,-45.699235444444,-45.748173577695,-45.7207469609017,-45.6343713934598,-45.6003755947174]}],[{"lng":[166.962425851921,166.949393052829,166.987792335244,166.947416384981,166.868999985619,166.962425851921],"lat":[-45.1477982791214,-45.2031774956885,-45.2585408461444,-45.2941630622485,-45.2405394789924,-45.1477982791214]}]],[[{"lng":[173.198887399729,173.297443983366,173.250831384127,173.304149350489,173.168700533592,173.151614666983,173.086652616993,173.003789650797,172.926235200656,172.847570550194,172.86109313253,172.735298849099,172.721472999322,172.639183050117,172.614713433524,172.479030949819,172.369593532568,172.335875833233,172.331950216583,172.26099479982,172.206730749948,172.135203666157,172.052126816993,172.115730567145,172.129322299744,172.247078967484,172.238130649319,172.320665484129,172.34245996745,172.418018282578,172.46311268413,172.584361567505,172.600312034113,172.657937583202,172.618004983595,172.485968450507,172.493938299216,172.310335033614,172.370078216958,172.229036100221,172.217804650849,172.292207984059,172.447285383514,172.60562558292,172.642595651343,172.728820134899,172.688014218755,172.692504033943,172.798009667228,172.886338016923,172.990330217499,173.063517816826,173.012366349789,173.033520217139,173.009530717519,173.06578501716,173.104255083169,173.198887399729],"lat":[-41.3306196997753,-41.3931415162802,-41.4665801165558,-41.5060320835981,-41.5311546995304,-41.5854709831784,-41.6249252333668,-41.7248032669424,-41.7577336161519,-41.8742874663461,-41.9224629661687,-42.0578953163025,-42.1034917994101,-42.1007946829437,-42.1954626498809,-42.2770294330973,-42.2806025168152,-42.2342079660356,-42.1506392829313,-42.1483124834312,-42.0983147832165,-42.1040439833797,-41.9451821329784,-41.8684047996669,-41.7140016329438,-41.6842177167088,-41.6395180999627,-41.6102873667673,-41.5131613498026,-41.4716592493225,-41.4043775665175,-41.3761944999689,-41.3018332326605,-41.239168999544,-41.1598956494134,-41.0542427327216,-41.0245242002173,-41.0135581163012,-40.9707524671654,-40.8558806664281,-40.7745427669185,-40.7473438326411,-40.6295302334237,-40.5644542999212,-40.5081192334808,-40.5290822657801,-40.5827790489934,-40.7278832002206,-40.8162795663909,-40.8323796326954,-40.7811902663483,-40.9057494657357,-40.9921395165831,-41.0887589498798,-41.1437780995614,-41.1838260998815,-41.29015973291,-41.3306196997753]}]],[[{"lng":[173.297443983366,173.198887399729,173.221776466012,173.310618882688,173.32361723313,173.412776467452,173.461631133591,173.593891449768,173.568365816496,173.523007850712,173.415419299657,173.40678916666,173.297443983366],"lat":[-41.3931415162802,-41.3306196997753,-41.2930119000069,-41.2507582163535,-41.2037450165907,-41.1494512164136,-41.1668533163242,-41.0511199330305,-41.1897309661611,-41.1979918667477,-41.2891416995037,-41.3309583501746,-41.3931415162802]}]],[[{"lng":[174.048786900106,173.955504883873,173.817253667021,173.744379950814,173.720210166329,173.499107499943,173.464463350147,173.312201366903,173.24452471748,173.189895532864,173.035789000756,172.992906316788,172.94139345023,172.914144833248,172.84243633332,172.823290099099,172.7216385824,172.721472999322,172.735298849099,172.86109313253,172.847570550194,172.926235200656,173.003789650797,173.086652616993,173.151614666983,173.168700533592,173.304149350489,173.250831384127,173.297443983366,173.40678916666,173.415419299657,173.523007850712,173.568365816496,173.593891449768,173.673303050289,173.802376834404,173.85077169915,173.868127116147,173.93680894915,173.993088400438,174.079004183599,174.17580193353,174.219448550258,174.12449421688,174.133062266944,174.048447900196,174.033535683903,174.072046116608,174.150420350879,174.15696061672,174.198299267036,174.275035250512,174.196758333519,174.048786900106],"lat":[-41.9681092162602,-41.9126783171065,-41.9329969833512,-41.9073832665075,-41.9607712162466,-42.0787366833871,-42.1956736999014,-42.2503815996964,-42.3031041161546,-42.4105463995019,-42.4834705328707,-42.403849533931,-42.3778250335143,-42.3086089000751,-42.2891840664509,-42.2047070167512,-42.1586981838795,-42.1034917994101,-42.0578953163025,-41.9224629661687,-41.8742874663461,-41.7577336161519,-41.7248032669424,-41.6249252333668,-41.5854709831784,-41.5311546995304,-41.5060320835981,-41.4665801165558,-41.3931415162802,-41.3309583501746,-41.2891416995037,-41.1979918667477,-41.1897309661611,-41.0511199330305,-41.0342675989878,-40.972247532291,-41.022320383094,-41.1442067667604,-41.0834601826331,-41.1021083834367,-41.0162762162912,-40.9990567827089,-41.0713428828236,-41.2362538666885,-41.2853295661851,-41.3931097327546,-41.4763469339435,-41.5239591995602,-41.5594337667488,-41.647669716411,-41.7232352500773,-41.7428873668553,-41.8356043168166,-41.9681092162602]}],[{"lng":[173.956358883868,173.960139751383,173.905318948269,173.813983967132,173.772206384171,173.805729534265,173.93662750116,173.956358883868],"lat":[-40.6928282325857,-40.7644749495513,-40.8572309998704,-40.9304674331604,-40.8619594325105,-40.8027343164386,-40.7475060664494,-40.6928282325857]}]]],null,"nz",{"interactive":true,"className":"","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},["<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>1<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Northland<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>12500.5611491<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>175500<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>23400<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.942453228842534<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>1<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>2<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Auckland<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>4941.5725565<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>1657200<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>29600<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.944285802583596<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>2<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>3<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Waikato<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>23900.0363831<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>460100<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>27900<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.952050024664133<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>3<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>4<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Bay of Plenty<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>12071.1446886<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>299900<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>26200<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.928039058955691<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>4<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>5<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Gisborne<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>8385.8266186<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>48500<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>24400<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.934973404255319<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>5<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>6<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Hawke's Bay<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>14137.5244406<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>164000<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>26100<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.923837520042758<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>6<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>7<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Taranaki<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>7254.4804331<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>118000<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>29100<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.956936261381896<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>7<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>8<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Manawatu-Wanganui<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>22220.6083872<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>234500<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>25000<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.938773377912444<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>8<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>9<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Wellington<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>North<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>8048.5527716<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>513900<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>32700<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.93355240486388<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>9<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>10<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>West Coast<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>23245.45588<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>32400<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>26900<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>1.01390716030821<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>10<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>11<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Canterbury<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>44504.4990912<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>612000<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>30100<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.975326544288084<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>11<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>12<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Otago<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>31186.3091885<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>224200<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>26300<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.951169446933996<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>12<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>13<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Southland<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>31196.0603552<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>98300<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>29500<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.978506931196744<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>13<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>14<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Tasman<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>9615.9760349<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>51100<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>25700<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.971898130723874<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>14<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>15<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Nelson<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>422.195242<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>51400<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>27200<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.925967400771432<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>15<\/td><\/tr><\/table><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\"><table id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td>16<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>Name<\/b><\/td><td>Marlborough<\/td><\/tr><tr><td>2<\/td><td><b>Island<\/b><\/td><td>South<\/td><\/tr><tr class='alt'><td>3<\/td><td><b>Land_area<\/b><\/td><td>10457.7454853<\/td><\/tr><tr><td>4<\/td><td><b>Population<\/b><\/td><td>46200<\/td><\/tr><tr class='alt'><td>5<\/td><td><b>Median_income<\/b><\/td><td>27900<\/td><\/tr><tr><td>6<\/td><td><b>Sex_ratio<\/b><\/td><td>0.957792207792208<\/td><\/tr><tr class='alt'><td>7<\/td><td><b>geom<\/b><\/td><td>sfc_MULTIPOLYGON<\/td><\/tr><tr><td>8<\/td><td><b>col<\/b><\/td><td>16<\/td><\/tr><\/table><\/body><\/html>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":2,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[166.426302922672,-47.2828524134173,178.550373600413,-34.4145187168343,"Zoom to nz","<strong> nz <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"nz",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[-47.2828524134173,-34.4145187168343],"lng":[166.426302922672,178.550373600413]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      });\n      return newDiv;\n      }\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n      //$(el).keypress(function (e) {\n      //  if (e.which == 32 || event.keyCode == 32) {\n      //    alert('space key is pressed');\n      //  }\n      //});\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n      map.on('mousemove', function (e) {\n      lnlt.text(\n                           ' x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ' +\n                           ' | lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() + ' ');\n      });\n      };\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p class="caption">
Figure 9.17: Illustration of mapview in action.
</p>
</div>
<!-- leaflet -->
<!-- leaflet plugins -->
</div>
<div id="web-mapping-applications-with-shiny" class="section level2">
<h2><span class="header-section-number">9.5</span> Web mapping applications with shiny</h2>
<p>The interactive web maps demonstrated in section <a href="adv-map.html#interactive-maps">9.4</a> can go far. Careful selection of layers to display, base-maps and pop-ups can be used to communicate the main results of many projects involving geocomputation. But the web mapping approach to interactivity has limitations:</p>
<ul>
<li>Although the map is interactive in terms of panning, zooming and clicking, the code is static, meaning the user interface is fixed.</li>
<li>All map content is generally static in a web map, meaning that web maps cannot scale to handle large datasets easily.</li>
<li>Additional layers of interactivity, such a graphs showing relationships between variables and ‘dashboards’ are difficult to create using the web-mapping approach.</li>
</ul>
<p>Overcoming these limitations involves going beyond static web mapping and towards geospatial frameworks and map servers. Products in this field include <a href="https://docs.djangoproject.com/en/2.0/ref/contrib/gis/">GeoDjango</a> (which extends the Django web framework and is written in <a href="https://github.com/django/django">Python</a>), <a href="https://www.osgeo.org/projects/mapguide-open-source/">MapGuide</a> (a framework for developing web applications, largely written in <a href="https://trac.osgeo.org/mapguide/wiki/MapGuideArchitecture">C++</a>) and <a href="http://geoserver.org/">GeoServer</a> (a mature and powerful map server written in <a href="https://github.com/geoserver/geoserver">Java</a>). Each of these (particularly GeoServer) is scalable, enabling maps to be served to thousands of people daily — assuming there is sufficient public interest in your maps! The bad news is that such server-side solutions require much skilled developer time to set-up and maintain, often involving teams of people with roles such as a dedicated geospatial database administrator (<a href="http://wiki.gis.com/wiki/index.php/Database_administrator">DBA</a>).</p>
<p>The good news is that web mapping applications can now be rapidly created using <strong>shiny</strong>, a package for converting R code into interactive web applications. This is thanks to its support for interactive maps via functions such as <code>renderLeaflet()</code>, documented on the <a href="https://rstudio.github.io/leaflet/shiny.html">Shiny integration</a> section of RStudio’s <strong>leaflet</strong> website. This section some context, teaches the basics of <strong>shiny</strong> from a web mapping perspective and culminates in a full-screen mapping application in less than 100 lines of code.</p>
<p>The way <strong>shiny</strong> works is well documented at <a href="https://shiny.rstudio.com/">shiny.rstudio.com</a>. The two key elements of a <strong>shiny</strong> app reflect the duality common to most web application development: ‘front end’ (the bit the user sees) and ‘back end’ code. In <strong>shiny</strong> apps these elements are typically created in objects named <code>ui</code> and <code>server</code> within an R script named <code>app.R</code>, that lives in an ‘app folder’. This allows web mapping applications to be represented in a single file, such as the <a href="https://github.com/Robinlovelace/geocompr/blob/master/coffeeApp/app.R"><code>coffeeApp/app.R</code></a> file in the book’s GitHub repo.</p>

<div class="rmdnote">
In <strong>shiny</strong> apps these are often split into <code>ui.R</code> (short for user interface) and <code>server.R</code> files, naming conventions used by <a href="https://github.com/rstudio/shiny-server"><code>shiny-server</code></a>, a server-side Linux application for serving shiny apps on public-facing websites <code>shiny-server</code> also serves apps defined by a single <code>app.R</code> file in an ‘app folder’.
</div>
<p></p>
<p>Before considering large apps it is worth seeing a minimal example, named ‘lifeApp’, in action.<a href="#fn57" class="footnoteRef" id="fnref57"><sup>57</sup></a> The code below defines and launches — with the command <code>shinyApp()</code> — a lifeApp, which provides an interactive slider allowing users to make countries appear with progressively lower levels of life expectancy (see Figure <a href="adv-map.html#fig:lifeApp">9.18</a>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ui =<span class="st"> </span><span class="kw">fluidPage</span>(
  <span class="kw">sliderInput</span>(<span class="dt">inputId =</span> <span class="st">&quot;life&quot;</span>, <span class="st">&quot;Life expectancy&quot;</span>, <span class="dv">0</span>, <span class="dv">80</span>, <span class="dt">value =</span> <span class="dv">80</span>),
      <span class="kw">leafletOutput</span>(<span class="dt">outputId =</span> <span class="st">&quot;map&quot;</span>)
  )
server =<span class="st"> </span>function(input, output) {
  output$map =<span class="st"> </span><span class="kw">renderLeaflet</span>({
    <span class="kw">leaflet</span>() %&gt;%<span class="st"> </span><span class="kw">addProviderTiles</span>(<span class="st">&quot;OpenStreetMap.BlackAndWhite&quot;</span>) %&gt;%
<span class="st">      </span><span class="kw">addPolygons</span>(<span class="dt">data =</span> world[world$lifeExp &gt;<span class="st"> </span>input$life, ])})
}
<span class="kw">shinyApp</span>(ui, server)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:lifeApp"></span>
<iframe src="https://bookdown.org/robinlovelace/lifeapp/?showcase=0" width="576" height="400px">
</iframe>
<p class="caption">
Figure 9.18: Minimal example of a web mapping application created with <strong>shiny</strong>.
</p>
</div>
<p>The <strong>user interface</strong> (<code>ui</code>) of lifeApp is created by <code>fluidPage()</code>. This contains input ‘widgets’ — a <code>sliderInput()</code> in this case (many other <code>*Input()</code> functions are available) — and outputs, a <code>leafletOutput()</code> in this case. Elements added to a <code>fluidPage()</code> are arranged row-wise by default, explaining why the slider interface is placed directly above the map in Figure <a href="adv-map.html#fig:lifeApp">9.18</a> (<code>?column</code> explains how to add content column-wise). The <strong>server side</strong> (<code>server</code>) is a function with <code>input</code> and <code>output</code> arguments. <code>output</code> is a list of objects containing elements generated by <code>render*()</code> function — <code>renderLeaflet()</code> which generates <code>output$map</code> in this case. Inputs elements such as <code>input$life</code> referred to in the server must relate to elements that exist in the <code>ui</code> — defined by <code>inputId = &quot;life&quot;</code> in the code above. The function <code>shinyApp()</code> combines both the <code>ui</code> and <code>server</code> elements and serves the results interactively via a new R process. When you move the slider in in Figure <a href="adv-map.html#fig:lifeApp">9.18</a>, you are actually causing R code to re-run, although this is hidden from view in the user interface.</p>
<p>Building on this basic example and knowing where to find help (see <code>?shiny</code>), the best way forward may be to stop reading and start programming! The recommended next step is to open the previously mentioned <a href="https://github.com/Robinlovelace/geocompr/blob/master/coffeeApp/app.R"><code>coffeeApp/app.R</code></a> script in an IDE of choice, modify it and re-run it repeatedly. The example contains some of the components of a web mapping application implemented in <strong>shiny</strong> and should ‘shine’ a light on how they behave (pun intended). The <code>coffeeApp/app.R</code> script contains <strong>shiny</strong> functions that go beyond those demonstrated in the simple ‘lifeApp’ example. These include <code>reactive()</code> and <code>observe()</code> (for creating outputs that respond to the user interface — see <code>?reactive</code>) and <code>leafletProxy()</code> (for modifying a <code>leaflet</code> object that has already been created). Such elements are critical to the creation of web mapping applications implemented in <strong>shiny</strong>.</p>
<div class="rmdnote">
<p>
There are a number of ways to run a <strong>shiny</strong> app. For RStudio users the simplest way is probably to click on the ‘Run App’ button located in the top right of the source pane when an <code>app.R</code>, <code>ui.R</code> or <code>server.R</code> script is open. <strong>shiny</strong> apps can also be initiated by using <code>runApp()</code> with the first argument being the folder containing the app code and data: <code>runApp(“coffeeApp”)</code> in this case (which assumes a folder named <code>coffeeApp</code> containing the <code>app.R</code> script is in your working directory). You can also launch apps from a Unix command line with the command <code>Rscript -e ‘shiny::runApp(“coffeeApp”)’</code>.
</p>
</div>
<p>Experimenting with apps such as <code>coffeeApp</code> will build not only your knowledge of web mapping applications in R but your practical skills. Changing the contents of <code>setView()</code>, for example, will change the starting bounding box that the user sees when the app is initiated. Such experimentation should not be done at random, but with reference to relevant documentation, starting with <code>?shiny</code>, and motivated by a desire to solve problems such as those posed in the exercises.</p>
<p><strong>shiny</strong> used in this way can make prototyping mapping applications faster and more accessible than ever before (deploying <strong>shiny</strong> apps is a separate topic beyond the scope of this chapter). Even if your applications are eventually deployed using different technologies, <strong>shiny</strong> undoubtedly allows web mapping applications to be developed in relatively few lines of code (60 in the case of coffeeApp). That does not stop shiny apps getting rather large. The Propensity to Cycle Tool (PCT) hosted at <a href="http://www.pct.bike/">pct.bike</a>, for example, is a national mapping tool funded by the UK’s Department for Transport. The PCT is used by dozens of people each day and has multiple interactive elements based on more than 1000 lines of <a href="https://github.com/npct/pct-shiny/blob/master/regions_www/m/server.R">code</a> <span class="citation">(Lovelace et al. <a href="#ref-lovelace_propensity_2017">2017</a>)</span>.</p>
<p>While such apps undoubtedly take time and effort to develop, <strong>shiny</strong> provides a framework for reproducible prototyping that should aid the development process. One potential problem with the ease of developing prototypes with <strong>shiny</strong> is the temptation to start programming too early, before the purpose of the mapping application has been envisioned in detail. For that reason, despite advocating <strong>shiny</strong>, we recommend starting with the longer established technology of a pen and paper as the first stage for interactive mapping projects. This way your prototype web applications should be limited not by technical considerations but by your motivations and imagination.</p>
<!-- Cite Propensity to Cycle Tool. -->
<div class="figure" style="text-align: center"><span id="fig:coffeeApp"></span>
<iframe src="https://bookdown.org/robinlovelace/coffeeapp/?showcase=0" width="576" height="400px">
</iframe>
<p class="caption">
Figure 9.19: coffeeApp, a simple web mapping application for exploring global coffee production in 2016 and 2017.
</p>
</div>
</div>
<div id="other-mapping-packages" class="section level2">
<h2><span class="header-section-number">9.6</span> Other mapping packages</h2>
<p><strong>tmap</strong> provides a powerful interface for creating a wide range of static maps (section <a href="adv-map.html#static-maps">9.2</a>) and also supports interactive maps (section <a href="adv-map.html#interactive-maps">9.4</a>). But there are many other options for creating maps in R. The aim of this section is to provide a taster of some of these and pointers for additional resources: map making is a surprisingly active area of R package development so there is more to learn than can be covered here.</p>
<p>The most mature option is to use <code>plot()</code> methods provided by core spatial packages <strong>sf</strong> and <strong>raster</strong>, covered in sections <a href="spatial-class.html#basic-map">2.1.3</a> and <a href="spatial-class.html#basic-map-raster">2.2.2</a> respectively. What we have not mentioned in those sections was that plot methods for raster and vector objects can be combined, as illustrated in the subsequent code chunk which generates Figure <a href="adv-map.html#fig:nz-plot">9.20</a>. <code>plot()</code> has many options which can be explored by following links in the <code>?plot</code> help page and the <strong>sf</strong> vignette <a href="https://cran.r-project.org/web/packages/sf/vignettes/sf5.html"><code>sf5</code></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">g =<span class="st"> </span><span class="kw">st_graticule</span>(nz, <span class="dt">lon =</span> <span class="kw">c</span>(<span class="dv">170</span>, <span class="dv">175</span>), <span class="dt">lat =</span> <span class="kw">c</span>(-<span class="dv">45</span>, -<span class="dv">40</span>, -<span class="dv">35</span>))
<span class="kw">plot</span>(nz_water, <span class="dt">graticule =</span> g, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)
raster::<span class="kw">plot</span>(nz_elev /<span class="st"> </span><span class="dv">1000</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(nz), <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:nz-plot"></span>
<img src="figures/nz-plot-1.png" alt="Map of New Zealand created with plot(). The legend to the left refers to elevation (1000 m above sea level)." width="576" />
<p class="caption">
Figure 9.20: Map of New Zealand created with plot(). The legend to the left refers to elevation (1000 m above sea level).
</p>
</div>
<p>Since version 2.2.2, the <strong>tidyverse</strong> plotting package <strong>ggplot2</strong> has supported <code>sf</code> objects with <code>geom_sf()</code>. The syntax is similar to that used by <strong>tmap</strong>: an initial <code>ggplot()</code> call is followed by one or more layers, that are added with <code>+ geom_*()</code>, where <code>*</code> represents a layer type such as <code>geom_sf()</code> (for sf objects) or <code>geom_points()</code> (for points).</p>
<p><strong>ggplot2</strong> plots graticules by default. The default settings for the graticules can be overridden using <code>scale_x_continuous()</code> and <code>scale_y_continuous()</code>. Other notable features include the use of unquoted variable names encapsulated in <code>aes()</code> to indicate which aesthetics vary and switching data sources using the <code>data</code> argument, as demonstrated in the code chunk below which creates Figure <a href="adv-map.html#fig:nz-gg">9.21</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
g1 =<span class="st"> </span><span class="kw">ggplot</span>() +<span class="st"> </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> nz, <span class="kw">aes</span>(<span class="dt">fill =</span> col)) +
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> nz_height) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">170</span>, <span class="dv">175</span>))
g1</code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:nz-gg"></span>
<img src="figures/nz-gg-1.png" alt="Map of New Zealand created with ggplot2." width="576" />
<p class="caption">
Figure 9.21: Map of New Zealand created with ggplot2.
</p>
</div>
<p>An advantage of <strong>ggplot2</strong> is that it has a strong user-community and many add-on packages. Good additional resources can be found in the open source <a href="https://github.com/hadley/ggplot2-book">ggplot2-book</a> and in the descriptions of the multitude of ‘<strong>gg</strong>packages’ such as <strong>ggrepel</strong> and <strong>tidygraph</strong>.</p>
<p>Another benefit of maps based on <strong>ggplot2</strong> is that they can easily be given a level of interactivity when printed using the function <code>ggplotly()</code> from the <strong>plotly</strong> package. Try <code>plotly::ggplotly(g1)</code> for example, and compare the result with other <strong>plotly</strong> mapping functions described at <a href="https://blog.cpsievert.me/2018/03/30/visualizing-geo-spatial-data-with-sf-and-plotly/">blog.cpsievert.me</a>.</p>
<p>We have covered mapping with <strong>sf</strong>, <strong>raster</strong> and <strong>ggplot2</strong> packages first because these packages are highly flexible, allowing for the creation of a wide range of static maps. Many other static mapping packages are more specific.</p>
<!-- JM: alternative mapping solutions are still missing -->
<p>Before we cover mapping packages for plotting a specific type of map (in the next paragraph), it is worth considering alternatives to the packages already covered for general-purpose static mapping (Table <a href="adv-map.html#tab:map-pkgs">9.1</a>).</p>
<table>
<caption><span id="tab:map-pkgs">Table 9.1: </span>Selected mapping packages, with associated metrics.</caption>
<thead>
<tr class="header">
<th align="left">package</th>
<th align="left">title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">cartography</td>
<td align="left">Thematic Cartography</td>
</tr>
<tr class="even">
<td align="left">ggplot2</td>
<td align="left">Create Elegant Data Visualisations Using the Grammar of Graphics</td>
</tr>
<tr class="odd">
<td align="left">leaflet</td>
<td align="left">Create Interactive Web Maps with Leaflet</td>
</tr>
<tr class="even">
<td align="left">mapview</td>
<td align="left">Interactive Viewing of Spatial Data in R</td>
</tr>
<tr class="odd">
<td align="left">plotly</td>
<td align="left">Create Interactive Web Graphics via ‘plotly.js’</td>
</tr>
<tr class="even">
<td align="left">rasterVis</td>
<td align="left">Visualization Methods for Raster Data</td>
</tr>
<tr class="odd">
<td align="left">tmap</td>
<td align="left">Thematic Maps</td>
</tr>
</tbody>
</table>
<p>Table <a href="adv-map.html#tab:map-pkgs">9.1</a> shows a range of mapping packages are available, and there are many others not listed in this table. Of note is <strong>cartography</strong>, which generates a range of unusual maps including choropleth, ‘proportional symbol’ and ‘flow’ maps, each of which is documented in the vignette <a href="https://cran.r-project.org/web/packages/cartography/vignettes/cartography.html"><code>cartography</code></a>.</p>
<!-- Pseudo (unusual) maps  -->
<!--we need a better name -->
<!-- I think we are abandoning this section - the links below can go into Other mapping packages (RL) -->
<!-- geofacet - https://hafen.github.io/geofacet/-->
<!-- population lines - https://github.com/rCarto/linemap-->
<!-- cartogram - https://github.com/sjewo/cartogram -->
<!-- geogrid - https://github.com/jbaileyh/geogrid -->
<!-- dot density maps -->
</div>
<div id="exercises-6" class="section level2">
<h2><span class="header-section-number">9.7</span> Exercises</h2>
<p>For these exercises we will create a new object, <code>africa</code>, using the <code>world</code> and <code>worldbank_df</code> datasets from the <strong>spData</strong> package (see chapter <a href="attr.html#attr">3</a> to learn more about attribute operations):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">africa =<span class="st"> </span>world %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(continent ==<span class="st"> &quot;Africa&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(worldbank_df, <span class="dt">by =</span> <span class="st">&quot;iso_a2&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(name, subregion, gdpPercap, HDI, pop_growth)</code></pre></div>
<p>We will also use <code>zion</code> and <code>nlcd</code> datasets from <strong>spDataLarge</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">zion =<span class="st"> </span><span class="kw">st_read</span>((<span class="kw">system.file</span>(<span class="st">&quot;vector/zion.gpkg&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;spDataLarge&quot;</span>))) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">st_transform</span>(<span class="dv">4326</span>)
<span class="co">#&gt; Reading layer `zion&#39; from data source `/home/travis/R/Library/spDataLarge/vector/zion.gpkg&#39; using driver `GPKG&#39;</span>
<span class="co">#&gt; Simple feature collection with 1 feature and 11 fields</span>
<span class="co">#&gt; geometry type:  POLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 303000 ymin: 4110000 xmax: 335000 ymax: 4150000</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    +proj=utm +zone=12 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs</span></code></pre></div>
<!-- static map 1 -->
<!-- static map 2 -->
<!-- static map 3 -->
<!-- faceted map -->
<!-- inset map -->
<!-- Robin, Jannes - any ideas how to make it more appealing? or suggestions of some other example? -->
<!-- animated map -->
<!-- @robin -->
<!-- interactive map -->
<!-- @robin -->
<!-- web mapping -->
<ol style="list-style-type: decimal">
<li>Sketch out on paper ideas for a web mapping app that could be used to make transport or land-use policies more evidence based:</li>
</ol>
<ul>
<li>In the city you live in, for a couple of users per day</li>
<li>In the country you live in, for dozens of users per day</li>
<li>Worldwide for hundreds of users per day and large data serving requirements</li>
</ul>
<ol style="list-style-type: decimal">
<li>How would app design, deployment and project management decisions change as the scale of map deployment increases?</li>
<li>Update the code in <code>coffeeApp/app.R</code> so that instead of centering on Brazil the user can select which country to focus on:
<ul>
<li>Using <code>textInput()</code></li>
<li>Using <code>selectInput()</code></li>
</ul></li>
</ol>
<!-- other mapping packages 1 -->
<!-- ggplot2 example? -->
<!-- other mapping packages 2 -->
<!-- cartogram example? -->

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-murrell_r_2016">
<p>Murrell, Paul. 2016. <em>R Graphics, Second Edition</em>. CRC Press.</p>
</div>
<div id="ref-talbert_ancient_2014">
<p>Talbert, Richard J. A. 2014. <em>Ancient Perspectives: Maps and Their Place in Mesopotamia, Egypt, Greece, and Rome</em>. University of Chicago Press.</p>
</div>
<div id="ref-tennekes_tmap_2018">
<p>Tennekes, Martijn. 2018b. “Tmap: Thematic Maps in R.” <em>Journal of Statistical Software, Articles</em> 84 (6): 1–39. doi:<a href="https://doi.org/10.18637/jss.v084.i06">10.18637/jss.v084.i06</a>.</p>
</div>
<div id="ref-borland_rainbow_2007">
<p>Borland, David, and Russell M Taylor Ii. 2007. “Rainbow Color Map (Still) Considered Harmful.” <em>IEEE Computer Graphics and Applications</em> 27 (2). IEEE.</p>
</div>
<div id="ref-lovelace_propensity_2017">
<p>Lovelace, Robin, Anna Goodman, Rachel Aldred, Nikolai Berkoff, Ali Abbas, and James Woodcock. 2017. “The Propensity to Cycle Tool: An Open Source Online System for Sustainable Transport Planning.” <em>Journal of Transport and Land Use</em> 10 (1). doi:<a href="https://doi.org/10.5198/jtlu.2016.862">10.5198/jtlu.2016.862</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="55">
<li id="fn55"><p>The <code>col = &quot;MAP_COLORS&quot;</code> argument can be used in maps with a large number of individual polygons (for example a map of individual countries). It creates unique colors for adjacent polygons.<a href="adv-map.html#fnref55">↩</a></p></li>
<li id="fn56"><p>See the “Color blindness simulator” options in <code>tmaptools::palette_explorer()</code>.<a href="adv-map.html#fnref56">↩</a></p></li>
<li id="fn57"><p>The word ‘app’ in this context refers to ‘web application’ and should not be confused with smartphone apps, the more common meaning of the word.<a href="adv-map.html#fnref57">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="location.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Robinlovelace/geocompr/edit/master/09-mapping.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
